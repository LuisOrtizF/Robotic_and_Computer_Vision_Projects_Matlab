<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="46,1" id="srcline1"> 1</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T2U3">chessboard</span> = initChessboard(<span class="var type1" id="S3T3U6">corners</span>,<span class="var type1" id="S4T6U7">idx</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="46,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% return if not enough corners</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,5" id="srcline5"> 5</a></span><span class="line">    <span class="keyword">if</span> size(<span class="var type1" id="S3T3U14">corners</span>.p,1)&lt;9</span></span>
<span class="srcline"><span class="lineno"><a href="46,6" id="srcline6"> 6</a></span><span class="line">      <span class="var type0" id="S2T0U20">chessboard</span> = [];</span></span>
<span class="srcline"><span class="lineno"><a href="46,7" id="srcline7"> 7</a></span><span class="line">      <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,8" id="srcline8"> 8</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,10" id="srcline10">10</a></span><span class="line">    <span class="comment">% init chessboard hypothesis</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T2:U5"><span class="var type1" id="S2T2U26">chessboard</span> = <span class="mxinfo " id="T55:U7">zeros(<span class="mxinfo " id="T6:U8">3</span>,<span class="mxinfo " id="T6:U9">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,12" id="srcline12">12</a></span><span class="line">    coder.varsize(<span class="string">'chessboard'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,13" id="srcline13">13</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="46,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T31:U10"><span class="var type1" id="S8T31U39">dist1</span>=<span class="mxinfo " id="T31:U12">zeros(<span class="mxinfo " id="T6:U13">1</span>,<span class="mxinfo " id="T6:U14">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T50:U15"><span class="var type1" id="S9T50U46">dist2</span>=<span class="mxinfo " id="T50:U17">zeros(<span class="mxinfo " id="T6:U18">1</span>,<span class="mxinfo " id="T6:U19">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,17" id="srcline17">17</a></span><span class="line">    <span class="comment">% extract feature index and orientation (central element)</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo " id="T31:U20"><span class="var type1" id="S10T31U53">v1</span> = <span class="mxinfo " id="T31:U22"><span class="mxinfo " id="T4:U23"><span class="var type1" id="S3T3U56">corners</span>.v1</span>(<span class="var type1" id="S4T6U58">idx</span>,<span class="mxinfo " id="T46:U26">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T31:U27"><span class="var type1" id="S11T31U62">v2</span> = <span class="mxinfo " id="T31:U29"><span class="mxinfo " id="T4:U30"><span class="var type1" id="S3T3U65">corners</span>.v2</span>(<span class="var type1" id="S4T6U67">idx</span>,<span class="mxinfo " id="T46:U33">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T6:U34"><span class="mxinfo " id="T6:U35"><span class="var type1" id="S2T2U72">chessboard</span>(<span class="mxinfo " id="T6:U37">2</span>,<span class="mxinfo " id="T6:U38">2</span>)</span> = <span class="var type1" id="S4T6U75">idx</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,22" id="srcline22">22</a></span><span class="line">    <span class="comment">% find left/right/top/bottom neighbors</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,23" id="srcline23">23</a></span><span class="line">    [<span class="mxinfo " id="T6:U40"><span class="var type1" id="S2T2U80">chessboard</span>(<span class="mxinfo " id="T6:U42">2</span>,<span class="mxinfo " id="T6:U43">3</span>)</span>,<span class="mxinfo " id="T6:U44"><span class="var type1" id="S8T31U84">dist1</span>(<span class="mxinfo " id="T16:U46">1</span>)</span>] = <span class="fcn" id="F121N14:B87">directionalNeighbor</span>(<span class="var type1" id="S4T6U88">idx</span>,+<span class="var type1" id="S10T31U90">v1</span>,<span class="var type1" id="S2T2U91">chessboard</span>,<span class="var type1" id="S3T3U92">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,24" id="srcline24">24</a></span><span class="line">    [<span class="mxinfo " id="T6:U51"><span class="var type1" id="S2T2U97">chessboard</span>(<span class="mxinfo " id="T6:U53">2</span>,<span class="mxinfo " id="T6:U54">1</span>)</span>,<span class="mxinfo " id="T6:U55"><span class="var type1" id="S8T31U101">dist1</span>(<span class="mxinfo " id="T16:U57">2</span>)</span>] = <span class="fcn" id="F121N14:B104">directionalNeighbor</span>(<span class="var type1" id="S4T6U105">idx</span>,<span class="mxinfo " id="T31:U59">-<span class="var type1" id="S10T31U107">v1</span></span>,<span class="var type1" id="S2T2U108">chessboard</span>,<span class="var type1" id="S3T3U109">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,25" id="srcline25">25</a></span><span class="line">    [<span class="mxinfo " id="T6:U63"><span class="var type1" id="S2T2U114">chessboard</span>(<span class="mxinfo " id="T6:U65">3</span>,<span class="mxinfo " id="T6:U66">2</span>)</span>,<span class="mxinfo " id="T6:U67"><span class="var type1" id="S9T50U118">dist2</span>(<span class="mxinfo " id="T16:U69">1</span>)</span>] = <span class="fcn" id="F121N14:B121">directionalNeighbor</span>(<span class="var type1" id="S4T6U122">idx</span>,+<span class="var type1" id="S11T31U124">v2</span>,<span class="var type1" id="S2T2U125">chessboard</span>,<span class="var type1" id="S3T3U126">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,26" id="srcline26">26</a></span><span class="line">    [<span class="mxinfo " id="T6:U74"><span class="var type1" id="S2T2U131">chessboard</span>(<span class="mxinfo " id="T6:U76">1</span>,<span class="mxinfo " id="T6:U77">2</span>)</span>,<span class="mxinfo " id="T6:U78"><span class="var type1" id="S9T50U135">dist2</span>(<span class="mxinfo " id="T16:U80">2</span>)</span>] = <span class="fcn" id="F121N14:B138">directionalNeighbor</span>(<span class="var type1" id="S4T6U139">idx</span>,<span class="mxinfo " id="T31:U82">-<span class="var type1" id="S11T31U141">v2</span></span>,<span class="var type1" id="S2T2U142">chessboard</span>,<span class="var type1" id="S3T3U143">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,28" id="srcline28">28</a></span><span class="line">    <span class="comment">% find top-left/top-right/bottom-left/bottom-right neighbors</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,29" id="srcline29">29</a></span><span class="line">    [<span class="mxinfo " id="T6:U86"><span class="var type1" id="S2T2U148">chessboard</span>(<span class="mxinfo " id="T6:U88">1</span>,<span class="mxinfo " id="T6:U89">1</span>)</span>,<span class="mxinfo " id="T6:U90"><span class="var type1" id="S9T50U152">dist2</span>(<span class="mxinfo " id="T16:U92">3</span>)</span>] = <span class="fcn" id="F121N14:B155">directionalNeighbor</span>(<span class="mxinfo " id="T6:U93"><span class="var type1" id="S2T2U157">chessboard</span>(<span class="mxinfo " id="T6:U95">2</span>,<span class="mxinfo " id="T6:U96">1</span>)</span>,<span class="mxinfo " id="T31:U97">-<span class="var type1" id="S11T31U161">v2</span></span>,<span class="var type1" id="S2T2U162">chessboard</span>,<span class="var type1" id="S3T3U163">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,30" id="srcline30">30</a></span><span class="line">    [<span class="mxinfo " id="T6:U101"><span class="var type1" id="S2T2U168">chessboard</span>(<span class="mxinfo " id="T6:U103">3</span>,<span class="mxinfo " id="T6:U104">1</span>)</span>,<span class="mxinfo " id="T6:U105"><span class="var type1" id="S9T50U172">dist2</span>(<span class="mxinfo " id="T16:U107">4</span>)</span>] = <span class="fcn" id="F121N14:B175">directionalNeighbor</span>(<span class="mxinfo " id="T6:U108"><span class="var type1" id="S2T2U177">chessboard</span>(<span class="mxinfo " id="T6:U110">2</span>,<span class="mxinfo " id="T6:U111">1</span>)</span>,+<span class="var type1" id="S11T31U181">v2</span>,<span class="var type1" id="S2T2U182">chessboard</span>,<span class="var type1" id="S3T3U183">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,31" id="srcline31">31</a></span><span class="line">    [<span class="mxinfo " id="T6:U115"><span class="var type1" id="S2T2U188">chessboard</span>(<span class="mxinfo " id="T6:U117">1</span>,<span class="mxinfo " id="T6:U118">3</span>)</span>,<span class="mxinfo " id="T6:U119"><span class="var type1" id="S9T50U192">dist2</span>(<span class="mxinfo " id="T16:U121">5</span>)</span>] = <span class="fcn" id="F121N14:B195">directionalNeighbor</span>(<span class="mxinfo " id="T6:U122"><span class="var type1" id="S2T2U197">chessboard</span>(<span class="mxinfo " id="T6:U124">2</span>,<span class="mxinfo " id="T6:U125">3</span>)</span>,<span class="mxinfo " id="T31:U126">-<span class="var type1" id="S11T31U201">v2</span></span>,<span class="var type1" id="S2T2U202">chessboard</span>,<span class="var type1" id="S3T3U203">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,32" id="srcline32">32</a></span><span class="line">    [<span class="mxinfo " id="T6:U130"><span class="var type1" id="S2T2U208">chessboard</span>(<span class="mxinfo " id="T6:U132">3</span>,<span class="mxinfo " id="T6:U133">3</span>)</span>,<span class="mxinfo " id="T6:U134"><span class="var type1" id="S9T50U212">dist2</span>(<span class="mxinfo " id="T16:U136">6</span>)</span>] = <span class="fcn" id="F121N14:B215">directionalNeighbor</span>(<span class="mxinfo " id="T6:U137"><span class="var type1" id="S2T2U217">chessboard</span>(<span class="mxinfo " id="T6:U139">2</span>,<span class="mxinfo " id="T6:U140">3</span>)</span>,+<span class="var type1" id="S11T31U221">v2</span>,<span class="var type1" id="S2T2U222">chessboard</span>,<span class="var type1" id="S3T3U223">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,34" id="srcline34">34</a></span><span class="line">    <span class="comment">% initialization must be homogenously distributed</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,35" id="srcline35">35</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T10:U144">any(<span class="mxinfo " id="T48:U145">isinf(<span class="var type1" id="S8T31U233">dist1</span>)</span>)</span> || <span class="mxinfo " id="T10:U147">any(<span class="mxinfo " id="T51:U148">isinf(<span class="var type1" id="S9T50U238">dist2</span>)</span>)</span> || <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,36" id="srcline36">36</a></span><span class="line">       <span class="mxinfo " id="T10:U150"><span class="mxinfo " id="T6:U151"><span class="mxinfo " id="T6:U152">std(<span class="var type1" id="S8T31U243">dist1</span>)</span>/<span class="mxinfo " id="T6:U154">mean(<span class="var type1" id="S8T31U246">dist1</span>)</span></span>&gt;<span class="mxinfo " id="T6:U156">0.3</span></span> || <span class="mxinfo " id="T10:U157"><span class="mxinfo " id="T6:U158"><span class="mxinfo " id="T6:U159">std(<span class="var type1" id="S9T50U252">dist2</span>)</span>/<span class="mxinfo " id="T6:U161">mean(<span class="var type1" id="S9T50U255">dist2</span>)</span></span>&gt;<span class="mxinfo " id="T6:U163">0.3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="46,37" id="srcline37">37</a></span><span class="line">      <span class="mxinfo " id="T2:U164"><span class="var type1" id="S2T2U259">chessboard</span> = <span class="mxinfo " id="T18:U166">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,38" id="srcline38">38</a></span><span class="line">      <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,39" id="srcline39">39</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,40" id="srcline40">40</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,41" id="srcline41">41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,42" id="srcline42">42</a></span><span class="line"></span></span>
</pre>
