<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="102,1" id="srcline1"> 1</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="102,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T2U3">maxima</span> = nonMaximumSuppression(<span class="var type1" id="S3T103U6">img</span>,<span class="var type2" id="S4T6V1U7">n</span>,<span class="var type1" id="S5T6U8">tau</span>,<span class="var type2" id="S6T6V2U9">margin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="102,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="102,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% extract parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,5" id="srcline5"> 5</a></span><span class="line">    <span class="mxinfo " id="T6:U6"><span class="var type1" id="S7T6U12">width</span>  = <span class="mxinfo " id="T6:U8">size(<span class="var type1" id="S3T103U15">img</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T6:U10"><span class="var type1" id="S9T6U19">height</span> = <span class="mxinfo " id="T6:U12">size(<span class="var type1" id="S3T103U22">img</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="102,8" id="srcline8"> 8</a></span><span class="line">    <span class="comment">% init maxima list</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T2:U14"><span class="var type1" id="S2T2U26">maxima</span>=<span class="mxinfo " id="T18:U16">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,10" id="srcline10">10</a></span><span class="line">    coder.varsize(<span class="string">'maxima'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="102,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="102,12" id="srcline12">12</a></span><span class="line">    <span class="comment">% non maximum suppression</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,13" id="srcline13">13</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S11T6U37">i</span>=<span class="mxinfo " id="T6:U18"><span class="var type1" id="S4T6U42">n</span>+1+<span class="var type1" id="S6T6U44">margin</span></span>:<span class="mxinfo " id="T6:U21"><span class="var type1" id="S4T6U46">n</span>+1</span>:<span class="var type1" id="S7T6U50">width</span>-<span class="var type1" id="S4T6U51">n</span>-<span class="var type1" id="S6T6U52">margin</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,14" id="srcline14">14</a></span><span class="line">      <span class="keyword">for</span> <span class="var type1" id="S12T6U55">j</span>=<span class="mxinfo " id="T6:U27"><span class="var type1" id="S4T6U60">n</span>+1+<span class="var type1" id="S6T6U62">margin</span></span>:<span class="mxinfo " id="T6:U30"><span class="var type1" id="S4T6U64">n</span>+1</span>:<span class="var type1" id="S9T6U68">height</span>-<span class="var type1" id="S4T6U69">n</span>-<span class="var type1" id="S6T6U70">margin</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="102,16" id="srcline16">16</a></span><span class="line">        <span class="mxinfo " id="T6:U35"><span class="var type1" id="S13T6U73">maxi</span>   = <span class="var type1" id="S11T6U74">i</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo " id="T6:U38"><span class="var type1" id="S14T6U77">maxj</span>   = <span class="var type1" id="S12T6U78">j</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,18" id="srcline18">18</a></span><span class="line">        <span class="mxinfo " id="T6:U41"><span class="var type1" id="S15T6U81">maxval</span> = <span class="mxinfo " id="T6:U43"><span class="var type1" id="S3T103U83">img</span>(<span class="var type1" id="S12T6U84">j</span>,<span class="var type1" id="S11T6U85">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="102,20" id="srcline20">20</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S16T6U88">i2</span>=<span class="var type1" id="S11T6U90">i</span>:<span class="var type1" id="S11T6U92">i</span>+<span class="var type1" id="S4T6U93">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,21" id="srcline21">21</a></span><span class="line">          <span class="keyword">for</span> <span class="var type1" id="S17T6U96">j2</span>=<span class="var type1" id="S12T6U98">j</span>:<span class="var type1" id="S12T6U100">j</span>+<span class="var type1" id="S4T6U101">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,22" id="srcline22">22</a></span><span class="line">            <span class="mxinfo " id="T6:U55"><span class="var type1" id="S18T6U104">currval</span> = <span class="mxinfo " id="T6:U57"><span class="var type1" id="S3T103U106">img</span>(<span class="var type1" id="S17T6U107">j2</span>,<span class="var type1" id="S16T6U108">i2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,23" id="srcline23">23</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T10:U61"><span class="var type1" id="S18T6U112">currval</span>&gt;<span class="var type1" id="S15T6U113">maxval</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="102,24" id="srcline24">24</a></span><span class="line">              <span class="mxinfo " id="T6:U64"><span class="var type1" id="S13T6U116">maxi</span>   = <span class="var type1" id="S16T6U117">i2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,25" id="srcline25">25</a></span><span class="line">              <span class="mxinfo " id="T6:U67"><span class="var type1" id="S14T6U120">maxj</span>   = <span class="var type1" id="S17T6U121">j2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,26" id="srcline26">26</a></span><span class="line">              <span class="mxinfo " id="T6:U70"><span class="var type1" id="S15T6U124">maxval</span> = <span class="var type1" id="S18T6U125">currval</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,27" id="srcline27">27</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,28" id="srcline28">28</a></span><span class="line">          <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,29" id="srcline29">29</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="102,31" id="srcline31">31</a></span><span class="line">        <span class="mxinfo " id="T6:U73"><span class="var type1" id="S19T6U128">failed</span> = <span class="mxinfo " id="T6:U75">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,32" id="srcline32">32</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S16T6U132">i2</span>=<span class="var type1" id="S13T6U135">maxi</span>-<span class="var type1" id="S4T6U136">n</span>:min(<span class="mxinfo " id="T6:U79"><span class="var type1" id="S13T6U140">maxi</span>+<span class="var type1" id="S4T6U141">n</span></span>,<span class="mxinfo " id="T6:U82"><span class="var type1" id="S7T6U143">width</span>-<span class="var type1" id="S6T6U144">margin</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="102,33" id="srcline33">33</a></span><span class="line">          <span class="keyword">for</span> <span class="var type1" id="S17T6U147">j2</span>=<span class="var type1" id="S14T6U150">maxj</span>-<span class="var type1" id="S4T6U151">n</span>:min(<span class="mxinfo " id="T6:U88"><span class="var type1" id="S14T6U155">maxj</span>+<span class="var type1" id="S4T6U156">n</span></span>,<span class="mxinfo " id="T6:U91"><span class="var type1" id="S9T6U158">height</span>-<span class="var type1" id="S6T6U159">margin</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="102,34" id="srcline34">34</a></span><span class="line">            <span class="mxinfo " id="T6:U94"><span class="var type1" id="S18T6U162">currval</span> = <span class="mxinfo " id="T6:U96"><span class="var type1" id="S3T103U164">img</span>(<span class="var type1" id="S17T6U165">j2</span>,<span class="var type1" id="S16T6U166">i2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,35" id="srcline35">35</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T10:U100"><span class="var type1" id="S18T6U171">currval</span>&gt;<span class="var type1" id="S15T6U172">maxval</span></span> &amp;&amp; (<span class="mxinfo " id="T10:U103"><span class="var type1" id="S16T6U178">i2</span>&lt;<span class="var type1" id="S11T6U179">i</span></span> || <span class="mxinfo " id="T10:U106"><span class="var type1" id="S16T6U181">i2</span>&gt;<span class="mxinfo " id="T6:U108"><span class="var type1" id="S11T6U183">i</span>+<span class="var type1" id="S4T6U184">n</span></span></span> || <span class="mxinfo " id="T10:U111"><span class="var type1" id="S17T6U186">j2</span>&lt;<span class="var type1" id="S12T6U187">j</span></span> || <span class="mxinfo " id="T10:U114"><span class="var type1" id="S17T6U189">j2</span>&gt;<span class="mxinfo " id="T6:U116"><span class="var type1" id="S12T6U191">j</span>+<span class="var type1" id="S4T6U192">n</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="102,36" id="srcline36">36</a></span><span class="line">              <span class="mxinfo " id="T6:U119"><span class="var type1" id="S19T6U195">failed</span> = <span class="mxinfo " id="T6:U121">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,37" id="srcline37">37</a></span><span class="line">              <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,38" id="srcline38">38</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,39" id="srcline39">39</a></span><span class="line">          <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,40" id="srcline40">40</a></span><span class="line">          <span class="keyword">if</span> <span class="var type1" id="S19T6U200">failed</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,41" id="srcline41">41</a></span><span class="line">            <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,42" id="srcline42">42</a></span><span class="line">          <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,43" id="srcline43">43</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,44" id="srcline44">44</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T10:U123"><span class="var type1" id="S15T6U206">maxval</span>&gt;=<span class="var type1" id="S5T6U207">tau</span></span> &amp;&amp; <span class="mxinfo " id="T10:U126">~<span class="var type1" id="S19T6U209">failed</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="102,45" id="srcline45">45</a></span><span class="line">          <span class="mxinfo " id="T2:U128"><span class="var type1" id="S2T2U212">maxima</span> = <span class="mxinfo " id="T35:U130">[<span class="var type1" id="S2T2U215">maxima</span>; <span class="mxinfo " id="T31:U132"><span class="var type1" id="S13T6U217">maxi</span> <span class="var type1" id="S14T6U218">maxj</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="102,46" id="srcline46">46</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,47" id="srcline47">47</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,48" id="srcline48">48</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="102,49" id="srcline49">49</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
