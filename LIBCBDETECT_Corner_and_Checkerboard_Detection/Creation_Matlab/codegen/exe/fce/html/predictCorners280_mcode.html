<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="77,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="77,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S19T35U286">pred</span> = predictCorners(<span class="var type1" id="S20T35U289">p1</span>,<span class="var type1" id="S21T35U290">p2</span>,<span class="var type1" id="S22T35U291">p3</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="77,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="77,56" id="srcline56"> 56</a></span><span class="line">    <span class="comment">% compute vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,57" id="srcline57"> 57</a></span><span class="line">    <span class="mxinfo " id="T35:U5"><span class="var type1" id="S23T35U294">v1</span> = <span class="mxinfo " id="T35:U7"><span class="var type1" id="S21T35U296">p2</span>-<span class="var type1" id="S20T35U297">p1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo " id="T35:U10"><span class="var type1" id="S24T35U300">v2</span> = <span class="mxinfo " id="T35:U12"><span class="var type1" id="S22T35U302">p3</span>-<span class="var type1" id="S21T35U303">p2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="77,60" id="srcline60"> 60</a></span><span class="line">    <span class="comment">% predict angles</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,61" id="srcline61"> 61</a></span><span class="line">    <span class="mxinfo " id="T13:U15"><span class="var type1" id="S25T13U306">a1</span> = <span class="mxinfo " id="T13:U17">atan2(<span class="mxinfo " id="T13:U18"><span class="var type1" id="S23T35U310">v1</span>(<span class="mxinfo " id="T47:U20">:</span>,<span class="mxinfo " id="T16:U21">2</span>)</span>,<span class="mxinfo " id="T13:U22"><span class="var type1" id="S23T35U314">v1</span>(<span class="mxinfo " id="T47:U24">:</span>,<span class="mxinfo " id="T16:U25">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,62" id="srcline62"> 62</a></span><span class="line">    <span class="mxinfo " id="T13:U26"><span class="var type1" id="S27T13U319">a2</span> = <span class="mxinfo " id="T13:U28">atan2(<span class="mxinfo " id="T13:U29"><span class="var type1" id="S24T35U323">v2</span>(<span class="mxinfo " id="T47:U31">:</span>,<span class="mxinfo " id="T16:U32">2</span>)</span>,<span class="mxinfo " id="T13:U33"><span class="var type1" id="S24T35U327">v2</span>(<span class="mxinfo " id="T47:U35">:</span>,<span class="mxinfo " id="T16:U36">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,63" id="srcline63"> 63</a></span><span class="line">    <span class="mxinfo " id="T13:U37"><span class="var type1" id="S28T13U332">a3</span> = <span class="mxinfo " id="T13:U39"><span class="mxinfo " id="T13:U40"><span class="mxinfo " id="T6:U41">2</span>*<span class="var type1" id="S27T13U336">a2</span></span>-<span class="var type1" id="S25T13U337">a1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,64" id="srcline64"> 64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="77,65" id="srcline65"> 65</a></span><span class="line">    <span class="comment">% predict scales</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,66" id="srcline66"> 66</a></span><span class="line">    <span class="mxinfo " id="T13:U44"><span class="var type1" id="S29T13U340">s1</span> = <span class="mxinfo " id="T13:U46">sqrt(<span class="mxinfo " id="T13:U47"><span class="mxinfo " id="T13:U48"><span class="mxinfo " id="T13:U49"><span class="var type1" id="S23T35U346">v1</span>(<span class="mxinfo " id="T47:U51">:</span>,<span class="mxinfo " id="T16:U52">1</span>)</span>.^2</span>+<span class="mxinfo " id="T13:U53"><span class="mxinfo " id="T13:U54"><span class="var type1" id="S23T35U352">v1</span>(<span class="mxinfo " id="T47:U56">:</span>,<span class="mxinfo " id="T16:U57">2</span>)</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,67" id="srcline67"> 67</a></span><span class="line">    <span class="mxinfo " id="T13:U58"><span class="var type1" id="S31T13U358">s2</span> = <span class="mxinfo " id="T13:U60">sqrt(<span class="mxinfo " id="T13:U61"><span class="mxinfo " id="T13:U62"><span class="mxinfo " id="T13:U63"><span class="var type1" id="S24T35U364">v2</span>(<span class="mxinfo " id="T47:U65">:</span>,<span class="mxinfo " id="T16:U66">1</span>)</span>.^2</span>+<span class="mxinfo " id="T13:U67"><span class="mxinfo " id="T13:U68"><span class="var type1" id="S24T35U370">v2</span>(<span class="mxinfo " id="T47:U70">:</span>,<span class="mxinfo " id="T16:U71">2</span>)</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,68" id="srcline68"> 68</a></span><span class="line">    <span class="mxinfo " id="T13:U72"><span class="var type1" id="S32T13U376">s3</span> = <span class="mxinfo " id="T13:U74"><span class="mxinfo " id="T13:U75"><span class="mxinfo " id="T6:U76">2</span>*<span class="var type1" id="S31T13U380">s2</span></span>-<span class="var type1" id="S29T13U381">s1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="77,70" id="srcline70"> 70</a></span><span class="line">    <span class="comment">% predict p3 (the factor 0.75 ensures that under extreme</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,71" id="srcline71"> 71</a></span><span class="line">    <span class="comment">% distortions (omnicam) the closer prediction is selected)</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,72" id="srcline72"> 72</a></span><span class="line">    <span class="mxinfo " id="T35:U79"><span class="var type1" id="S19T35U384">pred</span> = <span class="mxinfo " id="T35:U81"><span class="var type1" id="S22T35U386">p3</span> + <span class="mxinfo " id="T35:U83"><span class="mxinfo " id="T35:U84"><span class="mxinfo " id="T13:U85"><span class="mxinfo " id="T6:U86">0.75</span>*<span class="var type1" id="S32T13U391">s3</span></span>*<span class="mxinfo " id="T31:U88">ones(<span class="mxinfo " id="T6:U89">1</span>,<span class="mxinfo " id="T6:U90">2</span>)</span></span> .* <span class="mxinfo " id="T35:U91">[<span class="mxinfo " id="T13:U92">cos(<span class="var type1" id="S28T13U400">a3</span>)</span> <span class="mxinfo " id="T13:U94">sin(<span class="var type1" id="S28T13U403">a3</span>)</span>]</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="77,73" id="srcline73"> 73</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="77,74" id="srcline74"> 74</a></span><span class="line"></span></span>
</pre>
