<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="117,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T101U3">corners</span> = scoreCorners(<span class="var type1" id="S3T103U6">img</span>,<span class="mxinfo " id="T103:U3">~</span>,<span class="var type1" id="S4T103U8">img_weight</span>,<span class="var type1" id="S2T101U9">corners</span>,<span class="var type1" id="S5T58U10">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="117,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,3" id="srcline3"> 3</a></span><span class="line">    <span class="mxinfo " id="T6:U7"><span class="var type1" id="S6T6U13">width</span>  = <span class="mxinfo " id="T6:U9">size(<span class="var type1" id="S3T103U16">img</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,4" id="srcline4"> 4</a></span><span class="line">    <span class="mxinfo " id="T6:U11"><span class="var type1" id="S8T6U20">height</span> = <span class="mxinfo " id="T6:U13">size(<span class="var type1" id="S3T103U23">img</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T58:U15"><span class="var type1" id="S9T58U27">score</span>=<span class="mxinfo " id="T58:U17">zeros(<span class="mxinfo " id="T6:U18">1</span>,<span class="mxinfo " id="T6:U19">length(<span class="var type1" id="S5T58U33">radius</span>)</span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="117,7" id="srcline7"> 7</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="117,8" id="srcline8"> 8</a></span><span class="line">    <span class="comment">% for all corners do</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,9" id="srcline9"> 9</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S12T6U36">i</span>=<span class="mxinfo " id="T6:U22">1</span>:size(<span class="mxinfo " id="T2:U23"><span class="var type1" id="S2T101U42">corners</span>.p</span>,1)</span></span>
<span class="srcline"><span class="lineno"><a href="117,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,11" id="srcline11">11</a></span><span class="line">      <span class="comment">% corner location</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,12" id="srcline12">12</a></span><span class="line">      <span class="mxinfo " id="T6:U25"><span class="var type1" id="S13T6U47">u</span> = <span class="mxinfo " id="T6:U27">round(<span class="mxinfo " id="T6:U28"><span class="mxinfo " id="T2:U29"><span class="var type1" id="S2T101U52">corners</span>.p</span>(<span class="var type1" id="S12T6U54">i</span>,<span class="mxinfo " id="T6:U32">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,13" id="srcline13">13</a></span><span class="line">      <span class="mxinfo " id="T6:U33"><span class="var type1" id="S15T6U58">v</span> = <span class="mxinfo " id="T6:U35">round(<span class="mxinfo " id="T6:U36"><span class="mxinfo " id="T2:U37"><span class="var type1" id="S2T101U63">corners</span>.p</span>(<span class="var type1" id="S12T6U65">i</span>,<span class="mxinfo " id="T6:U40">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,15" id="srcline15">15</a></span><span class="line">      <span class="comment">% compute corner statistics @ radius 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,16" id="srcline16">16</a></span><span class="line">      <span class="keyword">for</span> <span class="var type1" id="S16T6U69">j</span>=<span class="mxinfo " id="T6:U42">1</span>:length(<span class="var type1" id="S5T58U74">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="117,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo " id="T6:U44"><span class="mxinfo " id="T6:U45"><span class="var type1" id="S9T58U78">score</span>(<span class="var type1" id="S16T6U79">j</span>)</span> = <span class="mxinfo " id="T6:U48">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,18" id="srcline18">18</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T10:U49"><span class="var type1" id="S13T6U87">u</span>&gt;<span class="mxinfo " id="T6:U51"><span class="var type1" id="S5T58U89">radius</span>(<span class="var type1" id="S16T6U90">j</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T10:U54"><span class="var type1" id="S13T6U92">u</span>&lt;=<span class="mxinfo " id="T6:U56"><span class="var type1" id="S6T6U94">width</span>-<span class="mxinfo " id="T6:U58"><span class="var type1" id="S5T58U96">radius</span>(<span class="var type1" id="S16T6U97">j</span>)</span></span></span> &amp;&amp; <span class="mxinfo " id="T10:U61"><span class="var type1" id="S15T6U99">v</span>&gt;<span class="mxinfo " id="T6:U63"><span class="var type1" id="S5T58U101">radius</span>(<span class="var type1" id="S16T6U102">j</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T10:U66"><span class="var type1" id="S15T6U104">v</span>&lt;=<span class="mxinfo " id="T6:U68"><span class="var type1" id="S8T6U106">height</span>-<span class="mxinfo " id="T6:U70"><span class="var type1" id="S5T58U108">radius</span>(<span class="var type1" id="S16T6U109">j</span>)</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="117,19" id="srcline19">19</a></span><span class="line">          <span class="mxinfo " id="T2:U73"><span class="var type1" id="S17T2U112">img_sub</span>        = <span class="mxinfo " id="T2:U75"><span class="var type1" id="S3T103U114">img</span>(<span class="mxinfo " id="T32:U77"><span class="mxinfo " id="T6:U78"><span class="var type1" id="S15T6U117">v</span>-<span class="mxinfo " id="T6:U80"><span class="var type1" id="S5T58U119">radius</span>(<span class="var type1" id="S16T6U120">j</span>)</span></span>:<span class="mxinfo " id="T6:U83"><span class="var type1" id="S15T6U122">v</span>+<span class="mxinfo " id="T6:U85"><span class="var type1" id="S5T58U124">radius</span>(<span class="var type1" id="S16T6U125">j</span>)</span></span></span>,<span class="mxinfo " id="T32:U88"><span class="mxinfo " id="T6:U89"><span class="var type1" id="S13T6U128">u</span>-<span class="mxinfo " id="T6:U91"><span class="var type1" id="S5T58U130">radius</span>(<span class="var type1" id="S16T6U131">j</span>)</span></span>:<span class="mxinfo " id="T6:U94"><span class="var type1" id="S13T6U133">u</span>+<span class="mxinfo " id="T6:U96"><span class="var type1" id="S5T58U135">radius</span>(<span class="var type1" id="S16T6U136">j</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,20" id="srcline20">20</a></span><span class="line">          <span class="mxinfo " id="T2:U99"><span class="var type1" id="S18T2U139">img_weight_sub</span> = <span class="mxinfo " id="T2:U101"><span class="var type1" id="S4T103U141">img_weight</span>(<span class="mxinfo " id="T32:U103"><span class="mxinfo " id="T6:U104"><span class="var type1" id="S15T6U144">v</span>-<span class="mxinfo " id="T6:U106"><span class="var type1" id="S5T58U146">radius</span>(<span class="var type1" id="S16T6U147">j</span>)</span></span>:<span class="mxinfo " id="T6:U109"><span class="var type1" id="S15T6U149">v</span>+<span class="mxinfo " id="T6:U111"><span class="var type1" id="S5T58U151">radius</span>(<span class="var type1" id="S16T6U152">j</span>)</span></span></span>,<span class="mxinfo " id="T32:U114"><span class="mxinfo " id="T6:U115"><span class="var type1" id="S13T6U155">u</span>-<span class="mxinfo " id="T6:U117"><span class="var type1" id="S5T58U157">radius</span>(<span class="var type1" id="S16T6U158">j</span>)</span></span>:<span class="mxinfo " id="T6:U120"><span class="var type1" id="S13T6U160">u</span>+<span class="mxinfo " id="T6:U122"><span class="var type1" id="S5T58U162">radius</span>(<span class="var type1" id="S16T6U163">j</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,21" id="srcline21">21</a></span><span class="line">          <span class="mxinfo " id="T6:U125"><span class="mxinfo " id="T6:U126"><span class="var type1" id="S9T58U167">score</span>(<span class="var type1" id="S16T6U168">j</span>)</span>       = <span class="mxinfo " id="T6:U129"><span class="fcn" id="F865N5:B170">cornerCorrelationScore</span>(<span class="var type1" id="S17T2U171">img_sub</span>,<span class="var type1" id="S18T2U172">img_weight_sub</span>,<span class="mxinfo " id="T32:U132"><span class="mxinfo " id="T2:U133"><span class="var type1" id="S2T101U175">corners</span>.v1</span>(<span class="var type1" id="S12T6U177">i</span>,<span class="mxinfo " id="T47:U136">:</span>)</span>,<span class="mxinfo " id="T32:U137"><span class="mxinfo " id="T2:U138"><span class="var type1" id="S2T101U181">corners</span>.v2</span>(<span class="var type1" id="S12T6U183">i</span>,<span class="mxinfo " id="T47:U141">:</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,22" id="srcline22">22</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,23" id="srcline23">23</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="117,25" id="srcline25">25</a></span><span class="line">      <span class="comment">% take highest score</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,26" id="srcline26">26</a></span><span class="line">      <span class="mxinfo " id="T6:U142"><span class="mxinfo " id="T6:U143"><span class="mxinfo " id="T13:U144"><span class="var type1" id="S2T101U189">corners</span>.score</span>(<span class="var type1" id="S12T6U191">i</span>,<span class="mxinfo " id="T6:U147">1</span>)</span> = <span class="mxinfo " id="T6:U148">max(<span class="var type1" id="S9T58U195">score</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="117,27" id="srcline27">27</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="117,28" id="srcline28">28</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
