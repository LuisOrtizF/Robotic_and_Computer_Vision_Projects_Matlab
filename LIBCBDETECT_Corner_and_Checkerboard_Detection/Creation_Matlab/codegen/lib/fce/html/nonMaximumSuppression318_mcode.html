<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="80,1" id="srcline1"> 1</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">maxima</span> = nonMaximumSuppression(<span class="var type1" id="S3T23U6">img</span>,<span class="var type2" id="S4T5V1U7">n</span>,<span class="var type1" id="S5T5U8">tau</span>,<span class="var type2" id="S6T5V2U9">margin</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% extract parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,5" id="srcline5"> 5</a></span><span class="line">    <span class="mxinfo " id="T5:U6"><span class="var type1" id="S7T5U12">width</span>  = <span class="mxinfo " id="T5:U8">size(<span class="var type1" id="S3T23U15">img</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T5:U10"><span class="var type1" id="S9T5U19">height</span> = <span class="mxinfo " id="T5:U12">size(<span class="var type1" id="S3T23U22">img</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,8" id="srcline8"> 8</a></span><span class="line">    <span class="comment">% init maxima list</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T1:U14"><span class="var type1" id="S2T1U26">maxima</span>=<span class="mxinfo " id="T66:U16">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,10" id="srcline10">10</a></span><span class="line">    coder.varsize(<span class="string">'maxima'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="80,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,12" id="srcline12">12</a></span><span class="line">    <span class="comment">% non maximum suppression</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,13" id="srcline13">13</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S11T5U37">i</span>=<span class="mxinfo " id="T5:U18"><span class="var type1" id="S4T5U42">n</span>+1+<span class="var type1" id="S6T5U44">margin</span></span>:<span class="mxinfo " id="T5:U21"><span class="var type1" id="S4T5U46">n</span>+1</span>:<span class="var type1" id="S7T5U50">width</span>-<span class="var type1" id="S4T5U51">n</span>-<span class="var type1" id="S6T5U52">margin</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,14" id="srcline14">14</a></span><span class="line">      <span class="keyword">for</span> <span class="var type1" id="S12T5U55">j</span>=<span class="mxinfo " id="T5:U27"><span class="var type1" id="S4T5U60">n</span>+1+<span class="var type1" id="S6T5U62">margin</span></span>:<span class="mxinfo " id="T5:U30"><span class="var type1" id="S4T5U64">n</span>+1</span>:<span class="var type1" id="S9T5U68">height</span>-<span class="var type1" id="S4T5U69">n</span>-<span class="var type1" id="S6T5U70">margin</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,16" id="srcline16">16</a></span><span class="line">        <span class="mxinfo " id="T5:U35"><span class="var type1" id="S13T5U73">maxi</span>   = <span class="var type1" id="S11T5U74">i</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo " id="T5:U38"><span class="var type1" id="S14T5U77">maxj</span>   = <span class="var type1" id="S12T5U78">j</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,18" id="srcline18">18</a></span><span class="line">        <span class="mxinfo " id="T5:U41"><span class="var type1" id="S15T5U81">maxval</span> = <span class="mxinfo " id="T5:U43"><span class="var type1" id="S3T23U83">img</span>(<span class="var type1" id="S12T5U84">j</span>,<span class="var type1" id="S11T5U85">i</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,20" id="srcline20">20</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S16T5U88">i2</span>=<span class="var type1" id="S11T5U90">i</span>:<span class="var type1" id="S11T5U92">i</span>+<span class="var type1" id="S4T5U93">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,21" id="srcline21">21</a></span><span class="line">          <span class="keyword">for</span> <span class="var type1" id="S17T5U96">j2</span>=<span class="var type1" id="S12T5U98">j</span>:<span class="var type1" id="S12T5U100">j</span>+<span class="var type1" id="S4T5U101">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,22" id="srcline22">22</a></span><span class="line">            <span class="mxinfo " id="T5:U55"><span class="var type1" id="S18T5U104">currval</span> = <span class="mxinfo " id="T5:U57"><span class="var type1" id="S3T23U106">img</span>(<span class="var type1" id="S17T5U107">j2</span>,<span class="var type1" id="S16T5U108">i2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,23" id="srcline23">23</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U61"><span class="var type1" id="S18T5U112">currval</span>&gt;<span class="var type1" id="S15T5U113">maxval</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="80,24" id="srcline24">24</a></span><span class="line">              <span class="mxinfo " id="T5:U64"><span class="var type1" id="S13T5U116">maxi</span>   = <span class="var type1" id="S16T5U117">i2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,25" id="srcline25">25</a></span><span class="line">              <span class="mxinfo " id="T5:U67"><span class="var type1" id="S14T5U120">maxj</span>   = <span class="var type1" id="S17T5U121">j2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,26" id="srcline26">26</a></span><span class="line">              <span class="mxinfo " id="T5:U70"><span class="var type1" id="S15T5U124">maxval</span> = <span class="var type1" id="S18T5U125">currval</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,27" id="srcline27">27</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,28" id="srcline28">28</a></span><span class="line">          <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,29" id="srcline29">29</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="80,31" id="srcline31">31</a></span><span class="line">        <span class="mxinfo " id="T5:U73"><span class="var type1" id="S19T5U128">failed</span> = <span class="mxinfo " id="T5:U75">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,32" id="srcline32">32</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S16T5U132">i2</span>=<span class="var type1" id="S13T5U135">maxi</span>-<span class="var type1" id="S4T5U136">n</span>:min(<span class="mxinfo " id="T5:U79"><span class="var type1" id="S13T5U140">maxi</span>+<span class="var type1" id="S4T5U141">n</span></span>,<span class="mxinfo " id="T5:U82"><span class="var type1" id="S7T5U143">width</span>-<span class="var type1" id="S6T5U144">margin</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,33" id="srcline33">33</a></span><span class="line">          <span class="keyword">for</span> <span class="var type1" id="S17T5U147">j2</span>=<span class="var type1" id="S14T5U150">maxj</span>-<span class="var type1" id="S4T5U151">n</span>:min(<span class="mxinfo " id="T5:U88"><span class="var type1" id="S14T5U155">maxj</span>+<span class="var type1" id="S4T5U156">n</span></span>,<span class="mxinfo " id="T5:U91"><span class="var type1" id="S9T5U158">height</span>-<span class="var type1" id="S6T5U159">margin</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,34" id="srcline34">34</a></span><span class="line">            <span class="mxinfo " id="T5:U94"><span class="var type1" id="S18T5U162">currval</span> = <span class="mxinfo " id="T5:U96"><span class="var type1" id="S3T23U164">img</span>(<span class="var type1" id="S17T5U165">j2</span>,<span class="var type1" id="S16T5U166">i2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,35" id="srcline35">35</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U100"><span class="var type1" id="S18T5U171">currval</span>&gt;<span class="var type1" id="S15T5U172">maxval</span></span> &amp;&amp; (<span class="mxinfo " id="T7:U103"><span class="var type1" id="S16T5U178">i2</span>&lt;<span class="var type1" id="S11T5U179">i</span></span> || <span class="mxinfo " id="T7:U106"><span class="var type1" id="S16T5U181">i2</span>&gt;<span class="mxinfo " id="T5:U108"><span class="var type1" id="S11T5U183">i</span>+<span class="var type1" id="S4T5U184">n</span></span></span> || <span class="mxinfo " id="T7:U111"><span class="var type1" id="S17T5U186">j2</span>&lt;<span class="var type1" id="S12T5U187">j</span></span> || <span class="mxinfo " id="T7:U114"><span class="var type1" id="S17T5U189">j2</span>&gt;<span class="mxinfo " id="T5:U116"><span class="var type1" id="S12T5U191">j</span>+<span class="var type1" id="S4T5U192">n</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="80,36" id="srcline36">36</a></span><span class="line">              <span class="mxinfo " id="T5:U119"><span class="var type1" id="S19T5U195">failed</span> = <span class="mxinfo " id="T5:U121">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,37" id="srcline37">37</a></span><span class="line">              <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,38" id="srcline38">38</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,39" id="srcline39">39</a></span><span class="line">          <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,40" id="srcline40">40</a></span><span class="line">          <span class="keyword">if</span> <span class="var type1" id="S19T5U200">failed</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,41" id="srcline41">41</a></span><span class="line">            <span class="keyword">break</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,42" id="srcline42">42</a></span><span class="line">          <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,43" id="srcline43">43</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,44" id="srcline44">44</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T7:U123"><span class="var type1" id="S15T5U206">maxval</span>&gt;=<span class="var type1" id="S5T5U207">tau</span></span> &amp;&amp; <span class="mxinfo " id="T7:U126">~<span class="var type1" id="S19T5U209">failed</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="80,45" id="srcline45">45</a></span><span class="line">          <span class="mxinfo " id="T1:U128"><span class="var type1" id="S2T1U212">maxima</span> = <span class="mxinfo " id="T75:U130">[<span class="var type1" id="S2T1U215">maxima</span>; <span class="mxinfo " id="T46:U132"><span class="var type1" id="S13T5U217">maxi</span> <span class="var type1" id="S14T5U218">maxj</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="80,46" id="srcline46">46</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,47" id="srcline47">47</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,48" id="srcline48">48</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="80,49" id="srcline49">49</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
