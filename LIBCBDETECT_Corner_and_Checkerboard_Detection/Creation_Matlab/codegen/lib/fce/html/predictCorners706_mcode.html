<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="116,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="116,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S19T75U286">pred</span> = predictCorners(<span class="var type1" id="S20T1U289">p1</span>,<span class="var type1" id="S21T1U290">p2</span>,<span class="var type1" id="S22T1U291">p3</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="116,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="116,56" id="srcline56"> 56</a></span><span class="line">    <span class="comment">% compute vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,57" id="srcline57"> 57</a></span><span class="line">    <span class="mxinfo " id="T1:U5"><span class="var type1" id="S23T1U294">v1</span> = <span class="mxinfo " id="T1:U7"><span class="var type1" id="S21T1U296">p2</span>-<span class="var type1" id="S20T1U297">p1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo " id="T1:U10"><span class="var type1" id="S24T1U300">v2</span> = <span class="mxinfo " id="T1:U12"><span class="var type1" id="S22T1U302">p3</span>-<span class="var type1" id="S21T1U303">p2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="116,60" id="srcline60"> 60</a></span><span class="line">    <span class="comment">% predict angles</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,61" id="srcline61"> 61</a></span><span class="line">    <span class="mxinfo " id="T4:U15"><span class="var type1" id="S25T4U306">a1</span> = <span class="mxinfo " id="T4:U17">atan2(<span class="mxinfo " id="T4:U18"><span class="var type1" id="S23T1U310">v1</span>(<span class="mxinfo " id="T86:U20">:</span>,<span class="mxinfo " id="T5:U21">2</span>)</span>,<span class="mxinfo " id="T4:U22"><span class="var type1" id="S23T1U314">v1</span>(<span class="mxinfo " id="T86:U24">:</span>,<span class="mxinfo " id="T5:U25">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,62" id="srcline62"> 62</a></span><span class="line">    <span class="mxinfo " id="T4:U26"><span class="var type1" id="S27T4U319">a2</span> = <span class="mxinfo " id="T4:U28">atan2(<span class="mxinfo " id="T4:U29"><span class="var type1" id="S24T1U323">v2</span>(<span class="mxinfo " id="T86:U31">:</span>,<span class="mxinfo " id="T5:U32">2</span>)</span>,<span class="mxinfo " id="T4:U33"><span class="var type1" id="S24T1U327">v2</span>(<span class="mxinfo " id="T86:U35">:</span>,<span class="mxinfo " id="T5:U36">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,63" id="srcline63"> 63</a></span><span class="line">    <span class="mxinfo " id="T4:U37"><span class="var type1" id="S28T4U332">a3</span> = <span class="mxinfo " id="T4:U39"><span class="mxinfo " id="T4:U40"><span class="mxinfo " id="T5:U41">2</span>*<span class="var type1" id="S27T4U336">a2</span></span>-<span class="var type1" id="S25T4U337">a1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,64" id="srcline64"> 64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="116,65" id="srcline65"> 65</a></span><span class="line">    <span class="comment">% predict scales</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,66" id="srcline66"> 66</a></span><span class="line">    <span class="mxinfo " id="T4:U44"><span class="var type1" id="S29T4U340">s1</span> = <span class="mxinfo " id="T4:U46">sqrt(<span class="mxinfo " id="T4:U47"><span class="mxinfo " id="T4:U48"><span class="mxinfo " id="T4:U49"><span class="var type1" id="S23T1U346">v1</span>(<span class="mxinfo " id="T86:U51">:</span>,<span class="mxinfo " id="T5:U52">1</span>)</span>.^2</span>+<span class="mxinfo " id="T4:U53"><span class="mxinfo " id="T4:U54"><span class="var type1" id="S23T1U352">v1</span>(<span class="mxinfo " id="T86:U56">:</span>,<span class="mxinfo " id="T5:U57">2</span>)</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,67" id="srcline67"> 67</a></span><span class="line">    <span class="mxinfo " id="T4:U58"><span class="var type1" id="S31T4U358">s2</span> = <span class="mxinfo " id="T4:U60">sqrt(<span class="mxinfo " id="T4:U61"><span class="mxinfo " id="T4:U62"><span class="mxinfo " id="T4:U63"><span class="var type1" id="S24T1U364">v2</span>(<span class="mxinfo " id="T86:U65">:</span>,<span class="mxinfo " id="T5:U66">1</span>)</span>.^2</span>+<span class="mxinfo " id="T4:U67"><span class="mxinfo " id="T4:U68"><span class="var type1" id="S24T1U370">v2</span>(<span class="mxinfo " id="T86:U70">:</span>,<span class="mxinfo " id="T5:U71">2</span>)</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,68" id="srcline68"> 68</a></span><span class="line">    <span class="mxinfo " id="T4:U72"><span class="var type1" id="S32T4U376">s3</span> = <span class="mxinfo " id="T4:U74"><span class="mxinfo " id="T4:U75"><span class="mxinfo " id="T5:U76">2</span>*<span class="var type1" id="S31T4U380">s2</span></span>-<span class="var type1" id="S29T4U381">s1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="116,70" id="srcline70"> 70</a></span><span class="line">    <span class="comment">% predict p3 (the factor 0.75 ensures that under extreme</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,71" id="srcline71"> 71</a></span><span class="line">    <span class="comment">% distortions (omnicam) the closer prediction is selected)</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,72" id="srcline72"> 72</a></span><span class="line">    <span class="mxinfo " id="T75:U79"><span class="var type1" id="S19T75U384">pred</span> = <span class="mxinfo " id="T75:U81"><span class="var type1" id="S22T1U386">p3</span> + <span class="mxinfo " id="T75:U83"><span class="mxinfo " id="T75:U84"><span class="mxinfo " id="T4:U85"><span class="mxinfo " id="T5:U86">0.75</span>*<span class="var type1" id="S32T4U391">s3</span></span>*<span class="mxinfo " id="T46:U88">ones(<span class="mxinfo " id="T5:U89">1</span>,<span class="mxinfo " id="T5:U90">2</span>)</span></span> .* <span class="mxinfo " id="T75:U91">[<span class="mxinfo " id="T4:U92">cos(<span class="var type1" id="S28T4U400">a3</span>)</span> <span class="mxinfo " id="T4:U94">sin(<span class="var type1" id="S28T4U403">a3</span>)</span>]</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="116,73" id="srcline73"> 73</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="116,74" id="srcline74"> 74</a></span><span class="line"></span></span>
</pre>
