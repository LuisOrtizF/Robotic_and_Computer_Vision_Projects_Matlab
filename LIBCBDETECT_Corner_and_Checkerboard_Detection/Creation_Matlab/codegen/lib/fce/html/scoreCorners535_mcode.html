<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="109,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T3U3">corners</span> = scoreCorners(<span class="var type1" id="S3T23U6">img</span>,<span class="mxinfo " id="T23:U3">~</span>,<span class="var type1" id="S4T23U8">img_weight</span>,<span class="var type1" id="S2T3U9">corners</span>,<span class="var type1" id="S5T101U10">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="109,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="109,3" id="srcline3"> 3</a></span><span class="line">    <span class="mxinfo " id="T5:U7"><span class="var type1" id="S6T5U13">width</span>  = <span class="mxinfo " id="T5:U9">size(<span class="var type1" id="S3T23U16">img</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="109,4" id="srcline4"> 4</a></span><span class="line">    <span class="mxinfo " id="T5:U11"><span class="var type1" id="S8T5U20">height</span> = <span class="mxinfo " id="T5:U13">size(<span class="var type1" id="S3T23U23">img</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="109,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="109,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T101:U15"><span class="var type1" id="S9T101U27">score</span>=<span class="mxinfo " id="T101:U17">zeros(<span class="mxinfo " id="T5:U18">1</span>,<span class="mxinfo " id="T5:U19">length(<span class="var type1" id="S5T101U33">radius</span>)</span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="109,7" id="srcline7"> 7</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="109,8" id="srcline8"> 8</a></span><span class="line">    <span class="comment">% for all corners do</span></span></span>
<span class="srcline"><span class="lineno"><a href="109,9" id="srcline9"> 9</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S12T5U36">i</span>=<span class="mxinfo " id="T5:U22">1</span>:size(<span class="mxinfo " id="T1:U23"><span class="var type1" id="S2T3U42">corners</span>.p</span>,1)</span></span>
<span class="srcline"><span class="lineno"><a href="109,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="109,11" id="srcline11">11</a></span><span class="line">      <span class="comment">% corner location</span></span></span>
<span class="srcline"><span class="lineno"><a href="109,12" id="srcline12">12</a></span><span class="line">      <span class="mxinfo " id="T5:U25"><span class="var type1" id="S13T5U47">u</span> = <span class="mxinfo " id="T5:U27">round(<span class="mxinfo " id="T5:U28"><span class="mxinfo " id="T1:U29"><span class="var type1" id="S2T3U52">corners</span>.p</span>(<span class="var type1" id="S12T5U54">i</span>,<span class="mxinfo " id="T5:U32">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="109,13" id="srcline13">13</a></span><span class="line">      <span class="mxinfo " id="T5:U33"><span class="var type1" id="S15T5U58">v</span> = <span class="mxinfo " id="T5:U35">round(<span class="mxinfo " id="T5:U36"><span class="mxinfo " id="T1:U37"><span class="var type1" id="S2T3U63">corners</span>.p</span>(<span class="var type1" id="S12T5U65">i</span>,<span class="mxinfo " id="T5:U40">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="109,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="109,15" id="srcline15">15</a></span><span class="line">      <span class="comment">% compute corner statistics @ radius 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="109,16" id="srcline16">16</a></span><span class="line">      <span class="keyword">for</span> <span class="var type1" id="S16T5U69">j</span>=<span class="mxinfo " id="T5:U42">1</span>:length(<span class="var type1" id="S5T101U74">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="109,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo " id="T5:U44"><span class="mxinfo " id="T5:U45"><span class="var type1" id="S9T101U78">score</span>(<span class="var type1" id="S16T5U79">j</span>)</span> = <span class="mxinfo " id="T5:U48">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="109,18" id="srcline18">18</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T7:U49"><span class="var type1" id="S13T5U87">u</span>&gt;<span class="mxinfo " id="T5:U51"><span class="var type1" id="S5T101U89">radius</span>(<span class="var type1" id="S16T5U90">j</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T7:U54"><span class="var type1" id="S13T5U92">u</span>&lt;=<span class="mxinfo " id="T5:U56"><span class="var type1" id="S6T5U94">width</span>-<span class="mxinfo " id="T5:U58"><span class="var type1" id="S5T101U96">radius</span>(<span class="var type1" id="S16T5U97">j</span>)</span></span></span> &amp;&amp; <span class="mxinfo " id="T7:U61"><span class="var type1" id="S15T5U99">v</span>&gt;<span class="mxinfo " id="T5:U63"><span class="var type1" id="S5T101U101">radius</span>(<span class="var type1" id="S16T5U102">j</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T7:U66"><span class="var type1" id="S15T5U104">v</span>&lt;=<span class="mxinfo " id="T5:U68"><span class="var type1" id="S8T5U106">height</span>-<span class="mxinfo " id="T5:U70"><span class="var type1" id="S5T101U108">radius</span>(<span class="var type1" id="S16T5U109">j</span>)</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="109,19" id="srcline19">19</a></span><span class="line">          <span class="mxinfo " id="T1:U73"><span class="var type1" id="S17T1U112">img_sub</span>        = <span class="mxinfo " id="T1:U75"><span class="var type1" id="S3T23U114">img</span>(<span class="mxinfo " id="T98:U77"><span class="mxinfo " id="T5:U78"><span class="var type1" id="S15T5U117">v</span>-<span class="mxinfo " id="T5:U80"><span class="var type1" id="S5T101U119">radius</span>(<span class="var type1" id="S16T5U120">j</span>)</span></span>:<span class="mxinfo " id="T5:U83"><span class="var type1" id="S15T5U122">v</span>+<span class="mxinfo " id="T5:U85"><span class="var type1" id="S5T101U124">radius</span>(<span class="var type1" id="S16T5U125">j</span>)</span></span></span>,<span class="mxinfo " id="T98:U88"><span class="mxinfo " id="T5:U89"><span class="var type1" id="S13T5U128">u</span>-<span class="mxinfo " id="T5:U91"><span class="var type1" id="S5T101U130">radius</span>(<span class="var type1" id="S16T5U131">j</span>)</span></span>:<span class="mxinfo " id="T5:U94"><span class="var type1" id="S13T5U133">u</span>+<span class="mxinfo " id="T5:U96"><span class="var type1" id="S5T101U135">radius</span>(<span class="var type1" id="S16T5U136">j</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="109,20" id="srcline20">20</a></span><span class="line">          <span class="mxinfo " id="T1:U99"><span class="var type1" id="S18T1U139">img_weight_sub</span> = <span class="mxinfo " id="T1:U101"><span class="var type1" id="S4T23U141">img_weight</span>(<span class="mxinfo " id="T98:U103"><span class="mxinfo " id="T5:U104"><span class="var type1" id="S15T5U144">v</span>-<span class="mxinfo " id="T5:U106"><span class="var type1" id="S5T101U146">radius</span>(<span class="var type1" id="S16T5U147">j</span>)</span></span>:<span class="mxinfo " id="T5:U109"><span class="var type1" id="S15T5U149">v</span>+<span class="mxinfo " id="T5:U111"><span class="var type1" id="S5T101U151">radius</span>(<span class="var type1" id="S16T5U152">j</span>)</span></span></span>,<span class="mxinfo " id="T98:U114"><span class="mxinfo " id="T5:U115"><span class="var type1" id="S13T5U155">u</span>-<span class="mxinfo " id="T5:U117"><span class="var type1" id="S5T101U157">radius</span>(<span class="var type1" id="S16T5U158">j</span>)</span></span>:<span class="mxinfo " id="T5:U120"><span class="var type1" id="S13T5U160">u</span>+<span class="mxinfo " id="T5:U122"><span class="var type1" id="S5T101U162">radius</span>(<span class="var type1" id="S16T5U163">j</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="109,21" id="srcline21">21</a></span><span class="line">          <span class="mxinfo " id="T5:U125"><span class="mxinfo " id="T5:U126"><span class="var type1" id="S9T101U167">score</span>(<span class="var type1" id="S16T5U168">j</span>)</span>       = <span class="mxinfo " id="T5:U129"><span class="fcn" id="F519N5:B170">cornerCorrelationScore</span>(<span class="var type1" id="S17T1U171">img_sub</span>,<span class="var type1" id="S18T1U172">img_weight_sub</span>,<span class="mxinfo " id="T98:U132"><span class="mxinfo " id="T1:U133"><span class="var type1" id="S2T3U175">corners</span>.v1</span>(<span class="var type1" id="S12T5U177">i</span>,<span class="mxinfo " id="T86:U136">:</span>)</span>,<span class="mxinfo " id="T98:U137"><span class="mxinfo " id="T1:U138"><span class="var type1" id="S2T3U181">corners</span>.v2</span>(<span class="var type1" id="S12T5U183">i</span>,<span class="mxinfo " id="T86:U141">:</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="109,22" id="srcline22">22</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="109,23" id="srcline23">23</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="109,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="109,25" id="srcline25">25</a></span><span class="line">      <span class="comment">% take highest score</span></span></span>
<span class="srcline"><span class="lineno"><a href="109,26" id="srcline26">26</a></span><span class="line">      <span class="mxinfo " id="T5:U142"><span class="mxinfo " id="T5:U143"><span class="mxinfo " id="T4:U144"><span class="var type1" id="S2T3U189">corners</span>.score</span>(<span class="var type1" id="S12T5U191">i</span>,<span class="mxinfo " id="T5:U147">1</span>)</span> = <span class="mxinfo " id="T5:U148">max(<span class="var type1" id="S9T101U195">score</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="109,27" id="srcline27">27</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="109,28" id="srcline28">28</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
