<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="114,1" id="srcline1"> 1</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T143U3">template</span> = createCorrelationPatch(<span class="var type1" id="S3T6U6">angle_1</span>,<span class="var type1" id="S4T6U7">angle_2</span>,<span class="var type1" id="S5T6U8">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="114,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% width and height</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,5" id="srcline5"> 5</a></span><span class="line">    <span class="mxinfo " id="T6:U5"><span class="var type1" id="S6T6U11">width</span>  = <span class="mxinfo " id="T6:U7"><span class="mxinfo " id="T6:U8"><span class="var type1" id="S5T6U14">radius</span>*<span class="mxinfo " id="T6:U10">2</span></span>+<span class="mxinfo " id="T6:U11">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T6:U12"><span class="var type1" id="S7T6U19">height</span> = <span class="mxinfo " id="T6:U14"><span class="mxinfo " id="T6:U15"><span class="var type1" id="S5T6U22">radius</span>*<span class="mxinfo " id="T6:U17">2</span></span>+<span class="mxinfo " id="T6:U18">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,8" id="srcline8"> 8</a></span><span class="line">    <span class="comment">% initialize template</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T144:U19"><span class="mxinfo " id="T144:U20"><span class="var type1" id="S2T143U28">template</span>.a1</span> = <span class="mxinfo " id="T144:U22">zeros(<span class="var type1" id="S7T6U32">height</span>,<span class="var type1" id="S6T6U33">width</span>,<span class="string">'double'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T144:U25"><span class="mxinfo " id="T144:U26"><span class="var type1" id="S2T143U38">template</span>.a2</span> = <span class="mxinfo " id="T144:U28">zeros(<span class="var type1" id="S7T6U42">height</span>,<span class="var type1" id="S6T6U43">width</span>,<span class="string">'double'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T144:U31"><span class="mxinfo " id="T144:U32"><span class="var type1" id="S2T143U48">template</span>.b1</span> = <span class="mxinfo " id="T144:U34">zeros(<span class="var type1" id="S7T6U52">height</span>,<span class="var type1" id="S6T6U53">width</span>,<span class="string">'double'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo " id="T144:U37"><span class="mxinfo " id="T144:U38"><span class="var type1" id="S2T143U58">template</span>.b2</span> = <span class="mxinfo " id="T144:U40">zeros(<span class="var type1" id="S7T6U62">height</span>,<span class="var type1" id="S6T6U63">width</span>,<span class="string">'double'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,14" id="srcline14">14</a></span><span class="line">    <span class="comment">% midpoint</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T6:U43"><span class="var type1" id="S9T6U67">mu</span> = <span class="mxinfo " id="T6:U45"><span class="var type1" id="S5T6U69">radius</span>+<span class="mxinfo " id="T6:U47">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo " id="T6:U48"><span class="var type1" id="S10T6U73">mv</span> = <span class="mxinfo " id="T6:U50"><span class="var type1" id="S5T6U75">radius</span>+<span class="mxinfo " id="T6:U52">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,18" id="srcline18">18</a></span><span class="line">    <span class="comment">% compute normals from angles</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T35:U53"><span class="var type1" id="S11T35U79">n1</span> = <span class="mxinfo " id="T35:U55">[<span class="mxinfo " id="T6:U56">-<span class="mxinfo " id="T6:U57">sin(<span class="var type1" id="S3T6U85">angle_1</span>)</span></span> <span class="mxinfo " id="T6:U59">cos(<span class="var type1" id="S3T6U88">angle_1</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T35:U61"><span class="var type1" id="S14T35U91">n2</span> = <span class="mxinfo " id="T35:U63">[<span class="mxinfo " id="T6:U64">-<span class="mxinfo " id="T6:U65">sin(<span class="var type1" id="S4T6U97">angle_2</span>)</span></span> <span class="mxinfo " id="T6:U67">cos(<span class="var type1" id="S4T6U100">angle_2</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,22" id="srcline22">22</a></span><span class="line">    <span class="comment">% for all points in template do</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,23" id="srcline23">23</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S15T6U103">u</span>=<span class="mxinfo " id="T6:U70">1</span>:<span class="var type1" id="S6T6U106">width</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,24" id="srcline24">24</a></span><span class="line">      <span class="keyword">for</span> <span class="var type1" id="S16T6U109">v</span>=<span class="mxinfo " id="T6:U73">1</span>:<span class="var type1" id="S7T6U112">height</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,26" id="srcline26">26</a></span><span class="line">        <span class="comment">% vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,27" id="srcline27">27</a></span><span class="line">        <span class="mxinfo " id="T35:U75"><span class="var type1" id="S17T35U115">vec</span>  = <span class="mxinfo " id="T35:U77">[<span class="mxinfo " id="T6:U78"><span class="var type1" id="S15T6U119">u</span>-<span class="var type1" id="S9T6U120">mu</span></span> <span class="mxinfo " id="T6:U81"><span class="var type1" id="S16T6U122">v</span>-<span class="var type1" id="S10T6U123">mv</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,28" id="srcline28">28</a></span><span class="line">        <span class="mxinfo " id="T6:U84"><span class="var type1" id="S18T6U126">dist</span> = <span class="mxinfo " id="T6:U86">norm(<span class="var type1" id="S17T35U129">vec</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,30" id="srcline30">30</a></span><span class="line">        <span class="comment">% check on which side of the normals we are</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,31" id="srcline31">31</a></span><span class="line">        <span class="mxinfo " id="T6:U88"><span class="var type1" id="S20T6U132">s1</span> = <span class="mxinfo " id="T6:U90"><span class="var type1" id="S17T35U134">vec</span>*<span class="mxinfo " id="T163:U92"><span class="var type1" id="S11T35U136">n1</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,32" id="srcline32">32</a></span><span class="line">        <span class="mxinfo " id="T6:U94"><span class="var type1" id="S21T6U139">s2</span> = <span class="mxinfo " id="T6:U96"><span class="var type1" id="S17T35U141">vec</span>*<span class="mxinfo " id="T163:U98"><span class="var type1" id="S14T35U143">n2</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,34" id="srcline34">34</a></span><span class="line">        <span class="mxinfo " id="T12:U100"><span class="keyword">if</span> <span class="mxinfo " id="T12:U101"><span class="mxinfo " id="T12:U102"><span class="var type1" id="S20T6U148">s1</span>&lt;=<span class="mxinfo " id="T6:U104">-<span class="mxinfo " id="T6:U105">0.1</span></span></span> &amp;&amp; <span class="mxinfo " id="T12:U106"><span class="var type1" id="S21T6U152">s2</span>&lt;=<span class="mxinfo " id="T6:U108">-<span class="mxinfo " id="T6:U109">0.1</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="114,35" id="srcline35">35</a></span><span class="line">          <span class="mxinfo " id="T6:U110"><span class="mxinfo " id="T6:U111"><span class="mxinfo " id="T144:U112"><span class="var type1" id="S2T143U159">template</span>.a1</span>(<span class="var type1" id="S16T6U161">v</span>,<span class="var type1" id="S15T6U162">u</span>)</span> = <span class="mxinfo " id="T6:U116">normpdf(<span class="var type1" id="S18T6U165">dist</span>,<span class="mxinfo " id="T6:U118">0</span>,<span class="mxinfo " id="T6:U119"><span class="var type1" id="S5T6U168">radius</span>/<span class="mxinfo " id="T6:U121">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,36" id="srcline36">36</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T12:U123"><span class="mxinfo " id="T12:U124"><span class="var type1" id="S20T6U173">s1</span>&gt;=<span class="mxinfo " id="T6:U126">0.1</span></span> &amp;&amp; <span class="mxinfo " id="T12:U127"><span class="var type1" id="S21T6U176">s2</span>&gt;=<span class="mxinfo " id="T6:U129">0.1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="114,37" id="srcline37">37</a></span><span class="line">          <span class="mxinfo " id="T6:U130"><span class="mxinfo " id="T6:U131"><span class="mxinfo " id="T144:U132"><span class="var type1" id="S2T143U182">template</span>.a2</span>(<span class="var type1" id="S16T6U184">v</span>,<span class="var type1" id="S15T6U185">u</span>)</span> = <span class="mxinfo " id="T6:U136">normpdf(<span class="var type1" id="S18T6U188">dist</span>,<span class="mxinfo " id="T6:U138">0</span>,<span class="mxinfo " id="T6:U139"><span class="var type1" id="S5T6U191">radius</span>/<span class="mxinfo " id="T6:U141">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,38" id="srcline38">38</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T12:U143"><span class="mxinfo " id="T12:U144"><span class="var type1" id="S20T6U196">s1</span>&lt;=<span class="mxinfo " id="T6:U146">-<span class="mxinfo " id="T6:U147">0.1</span></span></span> &amp;&amp; <span class="mxinfo " id="T12:U148"><span class="var type1" id="S21T6U200">s2</span>&gt;=<span class="mxinfo " id="T6:U150">0.1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="114,39" id="srcline39">39</a></span><span class="line">          <span class="mxinfo " id="T6:U151"><span class="mxinfo " id="T6:U152"><span class="mxinfo " id="T144:U153"><span class="var type1" id="S2T143U206">template</span>.b1</span>(<span class="var type1" id="S16T6U208">v</span>,<span class="var type1" id="S15T6U209">u</span>)</span> = <span class="mxinfo " id="T6:U157">normpdf(<span class="var type1" id="S18T6U212">dist</span>,<span class="mxinfo " id="T6:U159">0</span>,<span class="mxinfo " id="T6:U160"><span class="var type1" id="S5T6U215">radius</span>/<span class="mxinfo " id="T6:U162">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,40" id="srcline40">40</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T12:U164"><span class="mxinfo " id="T12:U165"><span class="var type1" id="S20T6U220">s1</span>&gt;=<span class="mxinfo " id="T6:U167">0.1</span></span> &amp;&amp; <span class="mxinfo " id="T12:U168"><span class="var type1" id="S21T6U223">s2</span>&lt;=<span class="mxinfo " id="T6:U170">-<span class="mxinfo " id="T6:U171">0.1</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="114,41" id="srcline41">41</a></span><span class="line">          <span class="mxinfo " id="T6:U172"><span class="mxinfo " id="T6:U173"><span class="mxinfo " id="T144:U174"><span class="var type1" id="S2T143U230">template</span>.b2</span>(<span class="var type1" id="S16T6U232">v</span>,<span class="var type1" id="S15T6U233">u</span>)</span> = <span class="mxinfo " id="T6:U178">normpdf(<span class="var type1" id="S18T6U236">dist</span>,<span class="mxinfo " id="T6:U180">0</span>,<span class="mxinfo " id="T6:U181"><span class="var type1" id="S5T6U239">radius</span>/<span class="mxinfo " id="T6:U183">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,42" id="srcline42">42</a></span><span class="line">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="114,43" id="srcline43">43</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,44" id="srcline44">44</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="114,46" id="srcline46">46</a></span><span class="line">    <span class="comment">% normalize</span></span></span>
<span class="srcline"><span class="lineno"><a href="114,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo " id="T144:U184"><span class="mxinfo " id="T144:U185"><span class="var type1" id="S2T143U244">template</span>.a1</span> = <span class="mxinfo " id="T144:U187"><span class="mxinfo " id="T144:U188"><span class="var type1" id="S2T143U248">template</span>.a1</span>/<span class="mxinfo " id="T6:U190">sum(<span class="mxinfo " id="T139:U191"><span class="mxinfo " id="T144:U192"><span class="var type1" id="S2T143U254">template</span>.a1</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo " id="T144:U194"><span class="mxinfo " id="T144:U195"><span class="var type1" id="S2T143U260">template</span>.a2</span> = <span class="mxinfo " id="T144:U197"><span class="mxinfo " id="T144:U198"><span class="var type1" id="S2T143U264">template</span>.a2</span>/<span class="mxinfo " id="T6:U200">sum(<span class="mxinfo " id="T139:U201"><span class="mxinfo " id="T144:U202"><span class="var type1" id="S2T143U270">template</span>.a2</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T144:U204"><span class="mxinfo " id="T144:U205"><span class="var type1" id="S2T143U276">template</span>.b1</span> = <span class="mxinfo " id="T144:U207"><span class="mxinfo " id="T144:U208"><span class="var type1" id="S2T143U280">template</span>.b1</span>/<span class="mxinfo " id="T6:U210">sum(<span class="mxinfo " id="T139:U211"><span class="mxinfo " id="T144:U212"><span class="var type1" id="S2T143U286">template</span>.b1</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T144:U214"><span class="mxinfo " id="T144:U215"><span class="var type1" id="S2T143U292">template</span>.b2</span> = <span class="mxinfo " id="T144:U217"><span class="mxinfo " id="T144:U218"><span class="var type1" id="S2T143U296">template</span>.b2</span>/<span class="mxinfo " id="T6:U220">sum(<span class="mxinfo " id="T139:U221"><span class="mxinfo " id="T144:U222"><span class="var type1" id="S2T143U302">template</span>.b2</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="114,51" id="srcline51">51</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
