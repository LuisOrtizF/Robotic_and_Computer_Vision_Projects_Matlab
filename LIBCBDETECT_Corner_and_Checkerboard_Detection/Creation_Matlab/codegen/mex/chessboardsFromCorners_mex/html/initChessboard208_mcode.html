<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="46,1" id="srcline1"> 1</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T11U3">chessboard</span> = initChessboard(<span class="var type1" id="S3T3U6">corners</span>,<span class="var type1" id="S4T6U7">idx</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="46,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% return if not enough corners</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,5" id="srcline5"> 5</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T12:U4"><span class="mxinfo " id="T6:U5">size(<span class="var type1" id="S3T3U14">corners</span>.p,1)</span>&lt;<span class="mxinfo " id="T6:U7">9</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="46,6" id="srcline6"> 6</a></span><span class="line">      <span class="var type0" id="S2T0U20">chessboard</span> = [];</span></span>
<span class="srcline"><span class="lineno"><a href="46,7" id="srcline7"> 7</a></span><span class="line">      <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,8" id="srcline8"> 8</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,10" id="srcline10">10</a></span><span class="line">    <span class="comment">% init chessboard hypothesis</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T11:U8"><span class="var type1" id="S2T11U26">chessboard</span> = <span class="mxinfo " id="T66:U10">zeros(<span class="mxinfo " id="T6:U11">3</span>,<span class="mxinfo " id="T6:U12">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,12" id="srcline12">12</a></span><span class="line">    coder.varsize(<span class="string">'chessboard'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,13" id="srcline13">13</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="46,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T35:U13"><span class="var type1" id="S8T35U39">dist1</span>=<span class="mxinfo " id="T35:U15">zeros(<span class="mxinfo " id="T6:U16">1</span>,<span class="mxinfo " id="T6:U17">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T61:U18"><span class="var type1" id="S9T61U46">dist2</span>=<span class="mxinfo " id="T61:U20">zeros(<span class="mxinfo " id="T6:U21">1</span>,<span class="mxinfo " id="T6:U22">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,17" id="srcline17">17</a></span><span class="line">    <span class="comment">% extract feature index and orientation (central element)</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo " id="T35:U23"><span class="var type1" id="S10T35U53">v1</span> = <span class="mxinfo " id="T35:U25"><span class="mxinfo " id="T4:U26"><span class="var type1" id="S3T3U56">corners</span>.v1</span>(<span class="var type1" id="S4T6U58">idx</span>,<span class="mxinfo " id="T56:U29">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T35:U30"><span class="var type1" id="S11T35U62">v2</span> = <span class="mxinfo " id="T35:U32"><span class="mxinfo " id="T4:U33"><span class="var type1" id="S3T3U65">corners</span>.v2</span>(<span class="var type1" id="S4T6U67">idx</span>,<span class="mxinfo " id="T56:U36">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T6:U37"><span class="mxinfo " id="T6:U38"><span class="var type1" id="S2T11U72">chessboard</span>(<span class="mxinfo " id="T6:U40">2</span>,<span class="mxinfo " id="T6:U41">2</span>)</span> = <span class="var type1" id="S4T6U75">idx</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,22" id="srcline22">22</a></span><span class="line">    <span class="comment">% find left/right/top/bottom neighbors</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,23" id="srcline23">23</a></span><span class="line">    [<span class="mxinfo " id="T6:U43"><span class="var type1" id="S2T11U80">chessboard</span>(<span class="mxinfo " id="T6:U45">2</span>,<span class="mxinfo " id="T6:U46">3</span>)</span>,<span class="mxinfo " id="T6:U47"><span class="var type1" id="S8T35U84">dist1</span>(<span class="mxinfo " id="T18:U49">1</span>)</span>] = <span class="fcn" id="F122N14:B87">directionalNeighbor</span>(<span class="var type1" id="S4T6U88">idx</span>,+<span class="var type1" id="S10T35U90">v1</span>,<span class="var type1" id="S2T11U91">chessboard</span>,<span class="var type1" id="S3T3U92">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,24" id="srcline24">24</a></span><span class="line">    [<span class="mxinfo " id="T6:U54"><span class="var type1" id="S2T11U97">chessboard</span>(<span class="mxinfo " id="T6:U56">2</span>,<span class="mxinfo " id="T6:U57">1</span>)</span>,<span class="mxinfo " id="T6:U58"><span class="var type1" id="S8T35U101">dist1</span>(<span class="mxinfo " id="T18:U60">2</span>)</span>] = <span class="fcn" id="F122N14:B104">directionalNeighbor</span>(<span class="var type1" id="S4T6U105">idx</span>,<span class="mxinfo " id="T35:U62">-<span class="var type1" id="S10T35U107">v1</span></span>,<span class="var type1" id="S2T11U108">chessboard</span>,<span class="var type1" id="S3T3U109">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,25" id="srcline25">25</a></span><span class="line">    [<span class="mxinfo " id="T6:U66"><span class="var type1" id="S2T11U114">chessboard</span>(<span class="mxinfo " id="T6:U68">3</span>,<span class="mxinfo " id="T6:U69">2</span>)</span>,<span class="mxinfo " id="T6:U70"><span class="var type1" id="S9T61U118">dist2</span>(<span class="mxinfo " id="T18:U72">1</span>)</span>] = <span class="fcn" id="F122N14:B121">directionalNeighbor</span>(<span class="var type1" id="S4T6U122">idx</span>,+<span class="var type1" id="S11T35U124">v2</span>,<span class="var type1" id="S2T11U125">chessboard</span>,<span class="var type1" id="S3T3U126">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,26" id="srcline26">26</a></span><span class="line">    [<span class="mxinfo " id="T6:U77"><span class="var type1" id="S2T11U131">chessboard</span>(<span class="mxinfo " id="T6:U79">1</span>,<span class="mxinfo " id="T6:U80">2</span>)</span>,<span class="mxinfo " id="T6:U81"><span class="var type1" id="S9T61U135">dist2</span>(<span class="mxinfo " id="T18:U83">2</span>)</span>] = <span class="fcn" id="F122N14:B138">directionalNeighbor</span>(<span class="var type1" id="S4T6U139">idx</span>,<span class="mxinfo " id="T35:U85">-<span class="var type1" id="S11T35U141">v2</span></span>,<span class="var type1" id="S2T11U142">chessboard</span>,<span class="var type1" id="S3T3U143">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,28" id="srcline28">28</a></span><span class="line">    <span class="comment">% find top-left/top-right/bottom-left/bottom-right neighbors</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,29" id="srcline29">29</a></span><span class="line">    [<span class="mxinfo " id="T6:U89"><span class="var type1" id="S2T11U148">chessboard</span>(<span class="mxinfo " id="T6:U91">1</span>,<span class="mxinfo " id="T6:U92">1</span>)</span>,<span class="mxinfo " id="T6:U93"><span class="var type1" id="S9T61U152">dist2</span>(<span class="mxinfo " id="T18:U95">3</span>)</span>] = <span class="fcn" id="F122N14:B155">directionalNeighbor</span>(<span class="mxinfo " id="T6:U96"><span class="var type1" id="S2T11U157">chessboard</span>(<span class="mxinfo " id="T6:U98">2</span>,<span class="mxinfo " id="T6:U99">1</span>)</span>,<span class="mxinfo " id="T35:U100">-<span class="var type1" id="S11T35U161">v2</span></span>,<span class="var type1" id="S2T11U162">chessboard</span>,<span class="var type1" id="S3T3U163">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,30" id="srcline30">30</a></span><span class="line">    [<span class="mxinfo " id="T6:U104"><span class="var type1" id="S2T11U168">chessboard</span>(<span class="mxinfo " id="T6:U106">3</span>,<span class="mxinfo " id="T6:U107">1</span>)</span>,<span class="mxinfo " id="T6:U108"><span class="var type1" id="S9T61U172">dist2</span>(<span class="mxinfo " id="T18:U110">4</span>)</span>] = <span class="fcn" id="F122N14:B175">directionalNeighbor</span>(<span class="mxinfo " id="T6:U111"><span class="var type1" id="S2T11U177">chessboard</span>(<span class="mxinfo " id="T6:U113">2</span>,<span class="mxinfo " id="T6:U114">1</span>)</span>,+<span class="var type1" id="S11T35U181">v2</span>,<span class="var type1" id="S2T11U182">chessboard</span>,<span class="var type1" id="S3T3U183">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,31" id="srcline31">31</a></span><span class="line">    [<span class="mxinfo " id="T6:U118"><span class="var type1" id="S2T11U188">chessboard</span>(<span class="mxinfo " id="T6:U120">1</span>,<span class="mxinfo " id="T6:U121">3</span>)</span>,<span class="mxinfo " id="T6:U122"><span class="var type1" id="S9T61U192">dist2</span>(<span class="mxinfo " id="T18:U124">5</span>)</span>] = <span class="fcn" id="F122N14:B195">directionalNeighbor</span>(<span class="mxinfo " id="T6:U125"><span class="var type1" id="S2T11U197">chessboard</span>(<span class="mxinfo " id="T6:U127">2</span>,<span class="mxinfo " id="T6:U128">3</span>)</span>,<span class="mxinfo " id="T35:U129">-<span class="var type1" id="S11T35U201">v2</span></span>,<span class="var type1" id="S2T11U202">chessboard</span>,<span class="var type1" id="S3T3U203">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,32" id="srcline32">32</a></span><span class="line">    [<span class="mxinfo " id="T6:U133"><span class="var type1" id="S2T11U208">chessboard</span>(<span class="mxinfo " id="T6:U135">3</span>,<span class="mxinfo " id="T6:U136">3</span>)</span>,<span class="mxinfo " id="T6:U137"><span class="var type1" id="S9T61U212">dist2</span>(<span class="mxinfo " id="T18:U139">6</span>)</span>] = <span class="fcn" id="F122N14:B215">directionalNeighbor</span>(<span class="mxinfo " id="T6:U140"><span class="var type1" id="S2T11U217">chessboard</span>(<span class="mxinfo " id="T6:U142">2</span>,<span class="mxinfo " id="T6:U143">3</span>)</span>,+<span class="var type1" id="S11T35U221">v2</span>,<span class="var type1" id="S2T11U222">chessboard</span>,<span class="var type1" id="S3T3U223">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="46,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,34" id="srcline34">34</a></span><span class="line">    <span class="comment">% initialization must be homogenously distributed</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T12:U147"><span class="keyword">if</span> <span class="mxinfo " id="T12:U148"><span class="mxinfo " id="T12:U149">any(<span class="mxinfo " id="T59:U150">isinf(<span class="var type1" id="S8T35U233">dist1</span>)</span>)</span> || <span class="mxinfo " id="T12:U152">any(<span class="mxinfo " id="T62:U153">isinf(<span class="var type1" id="S9T61U238">dist2</span>)</span>)</span> || <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,36" id="srcline36">36</a></span><span class="line">       <span class="mxinfo " id="T12:U155"><span class="mxinfo " id="T6:U156"><span class="mxinfo " id="T6:U157">std(<span class="var type1" id="S8T35U243">dist1</span>)</span>/<span class="mxinfo " id="T6:U159">mean(<span class="var type1" id="S8T35U246">dist1</span>)</span></span>&gt;<span class="mxinfo " id="T6:U161">0.3</span></span> || <span class="mxinfo " id="T12:U162"><span class="mxinfo " id="T6:U163"><span class="mxinfo " id="T6:U164">std(<span class="var type1" id="S9T61U252">dist2</span>)</span>/<span class="mxinfo " id="T6:U166">mean(<span class="var type1" id="S9T61U255">dist2</span>)</span></span>&gt;<span class="mxinfo " id="T6:U168">0.3</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="46,37" id="srcline37">37</a></span><span class="line">      <span class="mxinfo " id="T11:U169"><span class="var type1" id="S2T11U259">chessboard</span> = <span class="mxinfo " id="T22:U171">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,38" id="srcline38">38</a></span><span class="line">      <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="46,39" id="srcline39">39</a></span><span class="line">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="46,40" id="srcline40">40</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="46,41" id="srcline41">41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="46,42" id="srcline42">42</a></span><span class="line"></span></span>
</pre>
