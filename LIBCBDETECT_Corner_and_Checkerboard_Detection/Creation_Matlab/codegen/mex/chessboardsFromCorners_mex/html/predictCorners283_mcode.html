<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="78,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S19T40U286">pred</span> = predictCorners(<span class="var type1" id="S20T40U289">p1</span>,<span class="var type1" id="S21T40U290">p2</span>,<span class="var type1" id="S22T40U291">p3</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="78,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,56" id="srcline56"> 56</a></span><span class="line">    <span class="comment">% compute vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,57" id="srcline57"> 57</a></span><span class="line">    <span class="mxinfo " id="T40:U5"><span class="var type1" id="S23T40U294">v1</span> = <span class="mxinfo " id="T40:U7"><span class="var type1" id="S21T40U296">p2</span>-<span class="var type1" id="S20T40U297">p1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo " id="T40:U10"><span class="var type1" id="S24T40U300">v2</span> = <span class="mxinfo " id="T40:U12"><span class="var type1" id="S22T40U302">p3</span>-<span class="var type1" id="S21T40U303">p2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,60" id="srcline60"> 60</a></span><span class="line">    <span class="comment">% predict angles</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,61" id="srcline61"> 61</a></span><span class="line">    <span class="mxinfo " id="T15:U15"><span class="var type1" id="S25T15U306">a1</span> = <span class="mxinfo " id="T15:U17">atan2(<span class="mxinfo " id="T15:U18"><span class="var type1" id="S23T40U310">v1</span>(<span class="mxinfo " id="T83:U20">:</span>,<span class="mxinfo " id="T18:U21">2</span>)</span>,<span class="mxinfo " id="T15:U22"><span class="var type1" id="S23T40U314">v1</span>(<span class="mxinfo " id="T83:U24">:</span>,<span class="mxinfo " id="T18:U25">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,62" id="srcline62"> 62</a></span><span class="line">    <span class="mxinfo " id="T15:U26"><span class="var type1" id="S27T15U319">a2</span> = <span class="mxinfo " id="T15:U28">atan2(<span class="mxinfo " id="T15:U29"><span class="var type1" id="S24T40U323">v2</span>(<span class="mxinfo " id="T83:U31">:</span>,<span class="mxinfo " id="T18:U32">2</span>)</span>,<span class="mxinfo " id="T15:U33"><span class="var type1" id="S24T40U327">v2</span>(<span class="mxinfo " id="T83:U35">:</span>,<span class="mxinfo " id="T18:U36">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,63" id="srcline63"> 63</a></span><span class="line">    <span class="mxinfo " id="T15:U37"><span class="var type1" id="S28T15U332">a3</span> = <span class="mxinfo " id="T15:U39"><span class="mxinfo " id="T15:U40"><span class="mxinfo " id="T6:U41">2</span>*<span class="var type1" id="S27T15U336">a2</span></span>-<span class="var type1" id="S25T15U337">a1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,64" id="srcline64"> 64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,65" id="srcline65"> 65</a></span><span class="line">    <span class="comment">% predict scales</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,66" id="srcline66"> 66</a></span><span class="line">    <span class="mxinfo " id="T15:U44"><span class="var type1" id="S29T15U340">s1</span> = <span class="mxinfo " id="T15:U46">sqrt(<span class="mxinfo " id="T15:U47"><span class="mxinfo " id="T15:U48"><span class="mxinfo " id="T15:U49"><span class="var type1" id="S23T40U346">v1</span>(<span class="mxinfo " id="T83:U51">:</span>,<span class="mxinfo " id="T18:U52">1</span>)</span>.^2</span>+<span class="mxinfo " id="T15:U53"><span class="mxinfo " id="T15:U54"><span class="var type1" id="S23T40U352">v1</span>(<span class="mxinfo " id="T83:U56">:</span>,<span class="mxinfo " id="T18:U57">2</span>)</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,67" id="srcline67"> 67</a></span><span class="line">    <span class="mxinfo " id="T15:U58"><span class="var type1" id="S31T15U358">s2</span> = <span class="mxinfo " id="T15:U60">sqrt(<span class="mxinfo " id="T15:U61"><span class="mxinfo " id="T15:U62"><span class="mxinfo " id="T15:U63"><span class="var type1" id="S24T40U364">v2</span>(<span class="mxinfo " id="T83:U65">:</span>,<span class="mxinfo " id="T18:U66">1</span>)</span>.^2</span>+<span class="mxinfo " id="T15:U67"><span class="mxinfo " id="T15:U68"><span class="var type1" id="S24T40U370">v2</span>(<span class="mxinfo " id="T83:U70">:</span>,<span class="mxinfo " id="T18:U71">2</span>)</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,68" id="srcline68"> 68</a></span><span class="line">    <span class="mxinfo " id="T15:U72"><span class="var type1" id="S32T15U376">s3</span> = <span class="mxinfo " id="T15:U74"><span class="mxinfo " id="T15:U75"><span class="mxinfo " id="T6:U76">2</span>*<span class="var type1" id="S31T15U380">s2</span></span>-<span class="var type1" id="S29T15U381">s1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="78,70" id="srcline70"> 70</a></span><span class="line">    <span class="comment">% predict p3 (the factor 0.75 ensures that under extreme</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,71" id="srcline71"> 71</a></span><span class="line">    <span class="comment">% distortions (omnicam) the closer prediction is selected)</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,72" id="srcline72"> 72</a></span><span class="line">    <span class="mxinfo " id="T40:U79"><span class="var type1" id="S19T40U384">pred</span> = <span class="mxinfo " id="T40:U81"><span class="var type1" id="S22T40U386">p3</span> + <span class="mxinfo " id="T40:U83"><span class="mxinfo " id="T40:U84"><span class="mxinfo " id="T15:U85"><span class="mxinfo " id="T6:U86">0.75</span>*<span class="var type1" id="S32T15U391">s3</span></span>*<span class="mxinfo " id="T35:U88">ones(<span class="mxinfo " id="T6:U89">1</span>,<span class="mxinfo " id="T6:U90">2</span>)</span></span> .* <span class="mxinfo " id="T40:U91">[<span class="mxinfo " id="T15:U92">cos(<span class="var type1" id="S28T15U400">a3</span>)</span> <span class="mxinfo " id="T15:U94">sin(<span class="var type1" id="S28T15U403">a3</span>)</span>]</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="78,73" id="srcline73"> 73</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="78,74" id="srcline74"> 74</a></span><span class="line"></span></span>
</pre>
