<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="130,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T136U3">corners</span> = scoreCorners(<span class="var type1" id="S3T138U6">img</span>,<span class="mxinfo " id="T138:U3">~</span>,<span class="var type1" id="S4T138U8">img_weight</span>,<span class="var type1" id="S2T136U9">corners</span>,<span class="var type1" id="S5T69U10">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="130,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,3" id="srcline3"> 3</a></span><span class="line">    <span class="mxinfo " id="T6:U7"><span class="var type1" id="S6T6U13">width</span>  = <span class="mxinfo " id="T6:U9">size(<span class="var type1" id="S3T138U16">img</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,4" id="srcline4"> 4</a></span><span class="line">    <span class="mxinfo " id="T6:U11"><span class="var type1" id="S8T6U20">height</span> = <span class="mxinfo " id="T6:U13">size(<span class="var type1" id="S3T138U23">img</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T69:U15"><span class="var type1" id="S9T69U27">score</span>=<span class="mxinfo " id="T69:U17">zeros(<span class="mxinfo " id="T6:U18">1</span>,<span class="mxinfo " id="T6:U19">length(<span class="var type1" id="S5T69U33">radius</span>)</span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="130,7" id="srcline7"> 7</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="130,8" id="srcline8"> 8</a></span><span class="line">    <span class="comment">% for all corners do</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,9" id="srcline9"> 9</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S12T6U36">i</span>=<span class="mxinfo " id="T6:U22">1</span>:size(<span class="mxinfo " id="T124:U23"><span class="var type1" id="S2T136U42">corners</span>.p</span>,1)</span></span>
<span class="srcline"><span class="lineno"><a href="130,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,11" id="srcline11">11</a></span><span class="line">      <span class="comment">% corner location</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,12" id="srcline12">12</a></span><span class="line">      <span class="mxinfo " id="T6:U25"><span class="var type1" id="S13T6U47">u</span> = <span class="mxinfo " id="T6:U27">round(<span class="mxinfo " id="T6:U28"><span class="mxinfo " id="T124:U29"><span class="var type1" id="S2T136U52">corners</span>.p</span>(<span class="var type1" id="S12T6U54">i</span>,<span class="mxinfo " id="T6:U32">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,13" id="srcline13">13</a></span><span class="line">      <span class="mxinfo " id="T6:U33"><span class="var type1" id="S15T6U58">v</span> = <span class="mxinfo " id="T6:U35">round(<span class="mxinfo " id="T6:U36"><span class="mxinfo " id="T124:U37"><span class="var type1" id="S2T136U63">corners</span>.p</span>(<span class="var type1" id="S12T6U65">i</span>,<span class="mxinfo " id="T6:U40">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,15" id="srcline15">15</a></span><span class="line">      <span class="comment">% compute corner statistics @ radius 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,16" id="srcline16">16</a></span><span class="line">      <span class="keyword">for</span> <span class="var type1" id="S16T6U69">j</span>=<span class="mxinfo " id="T6:U42">1</span>:length(<span class="var type1" id="S5T69U74">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="130,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo " id="T6:U44"><span class="mxinfo " id="T6:U45"><span class="var type1" id="S9T69U78">score</span>(<span class="var type1" id="S16T6U79">j</span>)</span> = <span class="mxinfo " id="T6:U48">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,18" id="srcline18">18</a></span><span class="line">        <span class="mxinfo " id="T12:U49"><span class="keyword">if</span> <span class="mxinfo " id="T12:U50"><span class="mxinfo " id="T12:U51"><span class="var type1" id="S13T6U87">u</span>&gt;<span class="mxinfo " id="T6:U53"><span class="var type1" id="S5T69U89">radius</span>(<span class="var type1" id="S16T6U90">j</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T12:U56"><span class="var type1" id="S13T6U92">u</span>&lt;=<span class="mxinfo " id="T6:U58"><span class="var type1" id="S6T6U94">width</span>-<span class="mxinfo " id="T6:U60"><span class="var type1" id="S5T69U96">radius</span>(<span class="var type1" id="S16T6U97">j</span>)</span></span></span> &amp;&amp; <span class="mxinfo " id="T12:U63"><span class="var type1" id="S15T6U99">v</span>&gt;<span class="mxinfo " id="T6:U65"><span class="var type1" id="S5T69U101">radius</span>(<span class="var type1" id="S16T6U102">j</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T12:U68"><span class="var type1" id="S15T6U104">v</span>&lt;=<span class="mxinfo " id="T6:U70"><span class="var type1" id="S8T6U106">height</span>-<span class="mxinfo " id="T6:U72"><span class="var type1" id="S5T69U108">radius</span>(<span class="var type1" id="S16T6U109">j</span>)</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="130,19" id="srcline19">19</a></span><span class="line">          <span class="mxinfo " id="T199:U75"><span class="var type1" id="S17T199U112">img_sub</span>        = <span class="mxinfo " id="T199:U77"><span class="var type1" id="S3T138U114">img</span>(<span class="mxinfo " id="T198:U79"><span class="mxinfo " id="T6:U80"><span class="var type1" id="S15T6U117">v</span>-<span class="mxinfo " id="T6:U82"><span class="var type1" id="S5T69U119">radius</span>(<span class="var type1" id="S16T6U120">j</span>)</span></span>:<span class="mxinfo " id="T6:U85"><span class="var type1" id="S15T6U122">v</span>+<span class="mxinfo " id="T6:U87"><span class="var type1" id="S5T69U124">radius</span>(<span class="var type1" id="S16T6U125">j</span>)</span></span></span>,<span class="mxinfo " id="T202:U90"><span class="mxinfo " id="T6:U91"><span class="var type1" id="S13T6U128">u</span>-<span class="mxinfo " id="T6:U93"><span class="var type1" id="S5T69U130">radius</span>(<span class="var type1" id="S16T6U131">j</span>)</span></span>:<span class="mxinfo " id="T6:U96"><span class="var type1" id="S13T6U133">u</span>+<span class="mxinfo " id="T6:U98"><span class="var type1" id="S5T69U135">radius</span>(<span class="var type1" id="S16T6U136">j</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,20" id="srcline20">20</a></span><span class="line">          <span class="mxinfo " id="T199:U101"><span class="var type1" id="S18T199U139">img_weight_sub</span> = <span class="mxinfo " id="T199:U103"><span class="var type1" id="S4T138U141">img_weight</span>(<span class="mxinfo " id="T198:U105"><span class="mxinfo " id="T6:U106"><span class="var type1" id="S15T6U144">v</span>-<span class="mxinfo " id="T6:U108"><span class="var type1" id="S5T69U146">radius</span>(<span class="var type1" id="S16T6U147">j</span>)</span></span>:<span class="mxinfo " id="T6:U111"><span class="var type1" id="S15T6U149">v</span>+<span class="mxinfo " id="T6:U113"><span class="var type1" id="S5T69U151">radius</span>(<span class="var type1" id="S16T6U152">j</span>)</span></span></span>,<span class="mxinfo " id="T202:U116"><span class="mxinfo " id="T6:U117"><span class="var type1" id="S13T6U155">u</span>-<span class="mxinfo " id="T6:U119"><span class="var type1" id="S5T69U157">radius</span>(<span class="var type1" id="S16T6U158">j</span>)</span></span>:<span class="mxinfo " id="T6:U122"><span class="var type1" id="S13T6U160">u</span>+<span class="mxinfo " id="T6:U124"><span class="var type1" id="S5T69U162">radius</span>(<span class="var type1" id="S16T6U163">j</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,21" id="srcline21">21</a></span><span class="line">          <span class="mxinfo " id="T6:U127"><span class="mxinfo " id="T6:U128"><span class="var type1" id="S9T69U167">score</span>(<span class="var type1" id="S16T6U168">j</span>)</span>       = <span class="mxinfo " id="T6:U131"><span class="fcn" id="F898N5:B170">cornerCorrelationScore</span>(<span class="var type1" id="S17T199U171">img_sub</span>,<span class="var type1" id="S18T199U172">img_weight_sub</span>,<span class="mxinfo " id="T201:U134"><span class="mxinfo " id="T124:U135"><span class="var type1" id="S2T136U175">corners</span>.v1</span>(<span class="var type1" id="S12T6U177">i</span>,<span class="mxinfo " id="T135:U138">:</span>)</span>,<span class="mxinfo " id="T201:U139"><span class="mxinfo " id="T124:U140"><span class="var type1" id="S2T136U181">corners</span>.v2</span>(<span class="var type1" id="S12T6U183">i</span>,<span class="mxinfo " id="T135:U143">:</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,22" id="srcline22">22</a></span><span class="line">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="130,23" id="srcline23">23</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="130,25" id="srcline25">25</a></span><span class="line">      <span class="comment">% take highest score</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,26" id="srcline26">26</a></span><span class="line">      <span class="mxinfo " id="T6:U144"><span class="mxinfo " id="T6:U145"><span class="mxinfo " id="T15:U146"><span class="var type1" id="S2T136U189">corners</span>.score</span>(<span class="var type1" id="S12T6U191">i</span>,<span class="mxinfo " id="T6:U149">1</span>)</span> = <span class="mxinfo " id="T6:U150">max(<span class="var type1" id="S9T69U195">score</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="130,27" id="srcline27">27</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="130,28" id="srcline28">28</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
