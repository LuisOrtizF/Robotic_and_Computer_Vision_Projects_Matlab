<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="91,1" id="srcline1"> 1</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T75U3">template</span> = createCorrelationPatch(<span class="var type1" id="S3T8U6">angle_1</span>,<span class="var type1" id="S4T8U7">angle_2</span>,<span class="var type1" id="S5T8U8">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="91,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% width and height</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,5" id="srcline5"> 5</a></span><span class="line">    <span class="mxinfo " id="T8:U5"><span class="var type1" id="S6T8U11">width</span>  = <span class="mxinfo " id="T8:U7"><span class="mxinfo " id="T8:U8"><span class="var type1" id="S5T8U14">radius</span>*<span class="mxinfo " id="T8:U10">2</span></span>+<span class="mxinfo " id="T8:U11">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T8:U12"><span class="var type1" id="S7T8U19">height</span> = <span class="mxinfo " id="T8:U14"><span class="mxinfo " id="T8:U15"><span class="var type1" id="S5T8U22">radius</span>*<span class="mxinfo " id="T8:U17">2</span></span>+<span class="mxinfo " id="T8:U18">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,7" id="srcline7"> 7</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,8" id="srcline8"> 8</a></span><span class="line">    <span class="comment">% initialize template</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T74:U19"><span class="mxinfo " id="T74:U20"><span class="var type1" id="S2T75U28">template</span>.a1</span> = <span class="mxinfo " id="T74:U22">zeros(<span class="var type1" id="S7T8U32">height</span>,<span class="var type1" id="S6T8U33">width</span>,<span class="string">'double'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T74:U25"><span class="mxinfo " id="T74:U26"><span class="var type1" id="S2T75U38">template</span>.a2</span> = <span class="mxinfo " id="T74:U28">zeros(<span class="var type1" id="S7T8U42">height</span>,<span class="var type1" id="S6T8U43">width</span>,<span class="string">'double'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T74:U31"><span class="mxinfo " id="T74:U32"><span class="var type1" id="S2T75U48">template</span>.b1</span> = <span class="mxinfo " id="T74:U34">zeros(<span class="var type1" id="S7T8U52">height</span>,<span class="var type1" id="S6T8U53">width</span>,<span class="string">'double'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo " id="T74:U37"><span class="mxinfo " id="T74:U38"><span class="var type1" id="S2T75U58">template</span>.b2</span> = <span class="mxinfo " id="T74:U40">zeros(<span class="var type1" id="S7T8U62">height</span>,<span class="var type1" id="S6T8U63">width</span>,<span class="string">'double'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,14" id="srcline14">14</a></span><span class="line">    <span class="comment">% midpoint</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T8:U43"><span class="var type1" id="S9T8U67">mu</span> = <span class="mxinfo " id="T8:U45"><span class="var type1" id="S5T8U69">radius</span>+<span class="mxinfo " id="T8:U47">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo " id="T8:U48"><span class="var type1" id="S10T8U73">mv</span> = <span class="mxinfo " id="T8:U50"><span class="var type1" id="S5T8U75">radius</span>+<span class="mxinfo " id="T8:U52">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,18" id="srcline18">18</a></span><span class="line">    <span class="comment">% compute normals from angles</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T51:U53"><span class="var type1" id="S11T51U79">n1</span> = <span class="mxinfo " id="T51:U55">[<span class="mxinfo " id="T8:U56">-<span class="mxinfo " id="T8:U57">sin(<span class="var type1" id="S3T8U85">angle_1</span>)</span></span> <span class="mxinfo " id="T8:U59">cos(<span class="var type1" id="S3T8U88">angle_1</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T51:U61"><span class="var type1" id="S14T51U91">n2</span> = <span class="mxinfo " id="T51:U63">[<span class="mxinfo " id="T8:U64">-<span class="mxinfo " id="T8:U65">sin(<span class="var type1" id="S4T8U97">angle_2</span>)</span></span> <span class="mxinfo " id="T8:U67">cos(<span class="var type1" id="S4T8U100">angle_2</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,22" id="srcline22">22</a></span><span class="line">    <span class="comment">% for all points in template do</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,23" id="srcline23">23</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S15T8U103">u</span>=<span class="mxinfo " id="T8:U70">1</span>:<span class="var type1" id="S6T8U106">width</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,24" id="srcline24">24</a></span><span class="line">      <span class="keyword">for</span> <span class="var type1" id="S16T8U109">v</span>=<span class="mxinfo " id="T8:U73">1</span>:<span class="var type1" id="S7T8U112">height</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,25" id="srcline25">25</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,26" id="srcline26">26</a></span><span class="line">        <span class="comment">% vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,27" id="srcline27">27</a></span><span class="line">        <span class="mxinfo " id="T51:U75"><span class="var type1" id="S17T51U115">vec</span>  = <span class="mxinfo " id="T51:U77">[<span class="mxinfo " id="T8:U78"><span class="var type1" id="S15T8U119">u</span>-<span class="var type1" id="S9T8U120">mu</span></span> <span class="mxinfo " id="T8:U81"><span class="var type1" id="S16T8U122">v</span>-<span class="var type1" id="S10T8U123">mv</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,28" id="srcline28">28</a></span><span class="line">        <span class="mxinfo " id="T8:U84"><span class="var type1" id="S18T8U126">dist</span> = <span class="mxinfo " id="T8:U86">norm(<span class="var type1" id="S17T51U129">vec</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,30" id="srcline30">30</a></span><span class="line">        <span class="comment">% check on which side of the normals we are</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,31" id="srcline31">31</a></span><span class="line">        <span class="mxinfo " id="T8:U88"><span class="var type1" id="S20T8U132">s1</span> = <span class="mxinfo " id="T8:U90"><span class="var type1" id="S17T51U134">vec</span>*<span class="mxinfo " id="T56:U92"><span class="var type1" id="S11T51U136">n1</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,32" id="srcline32">32</a></span><span class="line">        <span class="mxinfo " id="T8:U94"><span class="var type1" id="S21T8U139">s2</span> = <span class="mxinfo " id="T8:U96"><span class="var type1" id="S17T51U141">vec</span>*<span class="mxinfo " id="T56:U98"><span class="var type1" id="S14T51U143">n2</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,34" id="srcline34">34</a></span><span class="line">        <span class="mxinfo " id="T10:U100"><span class="keyword">if</span> <span class="mxinfo " id="T10:U101"><span class="mxinfo " id="T10:U102"><span class="var type1" id="S20T8U148">s1</span>&lt;=<span class="mxinfo " id="T8:U104">-<span class="mxinfo " id="T8:U105">0.1</span></span></span> &amp;&amp; <span class="mxinfo " id="T10:U106"><span class="var type1" id="S21T8U152">s2</span>&lt;=<span class="mxinfo " id="T8:U108">-<span class="mxinfo " id="T8:U109">0.1</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="91,35" id="srcline35">35</a></span><span class="line">          <span class="mxinfo " id="T8:U110"><span class="mxinfo " id="T8:U111"><span class="mxinfo " id="T74:U112"><span class="var type1" id="S2T75U159">template</span>.a1</span>(<span class="var type1" id="S16T8U161">v</span>,<span class="var type1" id="S15T8U162">u</span>)</span> = <span class="mxinfo " id="T8:U116">normpdf(<span class="var type1" id="S18T8U165">dist</span>,<span class="mxinfo " id="T8:U118">0</span>,<span class="mxinfo " id="T8:U119"><span class="var type1" id="S5T8U168">radius</span>/<span class="mxinfo " id="T8:U121">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,36" id="srcline36">36</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T10:U123"><span class="mxinfo " id="T10:U124"><span class="var type1" id="S20T8U173">s1</span>&gt;=<span class="mxinfo " id="T8:U126">0.1</span></span> &amp;&amp; <span class="mxinfo " id="T10:U127"><span class="var type1" id="S21T8U176">s2</span>&gt;=<span class="mxinfo " id="T8:U129">0.1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="91,37" id="srcline37">37</a></span><span class="line">          <span class="mxinfo " id="T8:U130"><span class="mxinfo " id="T8:U131"><span class="mxinfo " id="T74:U132"><span class="var type1" id="S2T75U182">template</span>.a2</span>(<span class="var type1" id="S16T8U184">v</span>,<span class="var type1" id="S15T8U185">u</span>)</span> = <span class="mxinfo " id="T8:U136">normpdf(<span class="var type1" id="S18T8U188">dist</span>,<span class="mxinfo " id="T8:U138">0</span>,<span class="mxinfo " id="T8:U139"><span class="var type1" id="S5T8U191">radius</span>/<span class="mxinfo " id="T8:U141">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,38" id="srcline38">38</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T10:U143"><span class="mxinfo " id="T10:U144"><span class="var type1" id="S20T8U196">s1</span>&lt;=<span class="mxinfo " id="T8:U146">-<span class="mxinfo " id="T8:U147">0.1</span></span></span> &amp;&amp; <span class="mxinfo " id="T10:U148"><span class="var type1" id="S21T8U200">s2</span>&gt;=<span class="mxinfo " id="T8:U150">0.1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="91,39" id="srcline39">39</a></span><span class="line">          <span class="mxinfo " id="T8:U151"><span class="mxinfo " id="T8:U152"><span class="mxinfo " id="T74:U153"><span class="var type1" id="S2T75U206">template</span>.b1</span>(<span class="var type1" id="S16T8U208">v</span>,<span class="var type1" id="S15T8U209">u</span>)</span> = <span class="mxinfo " id="T8:U157">normpdf(<span class="var type1" id="S18T8U212">dist</span>,<span class="mxinfo " id="T8:U159">0</span>,<span class="mxinfo " id="T8:U160"><span class="var type1" id="S5T8U215">radius</span>/<span class="mxinfo " id="T8:U162">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,40" id="srcline40">40</a></span><span class="line">        <span class="keyword">elseif</span> <span class="mxinfo " id="T10:U164"><span class="mxinfo " id="T10:U165"><span class="var type1" id="S20T8U220">s1</span>&gt;=<span class="mxinfo " id="T8:U167">0.1</span></span> &amp;&amp; <span class="mxinfo " id="T10:U168"><span class="var type1" id="S21T8U223">s2</span>&lt;=<span class="mxinfo " id="T8:U170">-<span class="mxinfo " id="T8:U171">0.1</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="91,41" id="srcline41">41</a></span><span class="line">          <span class="mxinfo " id="T8:U172"><span class="mxinfo " id="T8:U173"><span class="mxinfo " id="T74:U174"><span class="var type1" id="S2T75U230">template</span>.b2</span>(<span class="var type1" id="S16T8U232">v</span>,<span class="var type1" id="S15T8U233">u</span>)</span> = <span class="mxinfo " id="T8:U178">normpdf(<span class="var type1" id="S18T8U236">dist</span>,<span class="mxinfo " id="T8:U180">0</span>,<span class="mxinfo " id="T8:U181"><span class="var type1" id="S5T8U239">radius</span>/<span class="mxinfo " id="T8:U183">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,42" id="srcline42">42</a></span><span class="line">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="91,43" id="srcline43">43</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,44" id="srcline44">44</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,45" id="srcline45">45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="91,46" id="srcline46">46</a></span><span class="line">    <span class="comment">% normalize</span></span></span>
<span class="srcline"><span class="lineno"><a href="91,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo " id="T74:U184"><span class="mxinfo " id="T74:U185"><span class="var type1" id="S2T75U244">template</span>.a1</span> = <span class="mxinfo " id="T74:U187"><span class="mxinfo " id="T74:U188"><span class="var type1" id="S2T75U248">template</span>.a1</span>/<span class="mxinfo " id="T8:U190">sum(<span class="mxinfo " id="T73:U191"><span class="mxinfo " id="T74:U192"><span class="var type1" id="S2T75U254">template</span>.a1</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo " id="T74:U194"><span class="mxinfo " id="T74:U195"><span class="var type1" id="S2T75U260">template</span>.a2</span> = <span class="mxinfo " id="T74:U197"><span class="mxinfo " id="T74:U198"><span class="var type1" id="S2T75U264">template</span>.a2</span>/<span class="mxinfo " id="T8:U200">sum(<span class="mxinfo " id="T73:U201"><span class="mxinfo " id="T74:U202"><span class="var type1" id="S2T75U270">template</span>.a2</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,49" id="srcline49">49</a></span><span class="line">    <span class="mxinfo " id="T74:U204"><span class="mxinfo " id="T74:U205"><span class="var type1" id="S2T75U276">template</span>.b1</span> = <span class="mxinfo " id="T74:U207"><span class="mxinfo " id="T74:U208"><span class="var type1" id="S2T75U280">template</span>.b1</span>/<span class="mxinfo " id="T8:U210">sum(<span class="mxinfo " id="T73:U211"><span class="mxinfo " id="T74:U212"><span class="var type1" id="S2T75U286">template</span>.b1</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T74:U214"><span class="mxinfo " id="T74:U215"><span class="var type1" id="S2T75U292">template</span>.b2</span> = <span class="mxinfo " id="T74:U217"><span class="mxinfo " id="T74:U218"><span class="var type1" id="S2T75U296">template</span>.b2</span>/<span class="mxinfo " id="T8:U220">sum(<span class="mxinfo " id="T73:U221"><span class="mxinfo " id="T74:U222"><span class="var type1" id="S2T75U302">template</span>.b2</span>(:)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="91,51" id="srcline51">51</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
