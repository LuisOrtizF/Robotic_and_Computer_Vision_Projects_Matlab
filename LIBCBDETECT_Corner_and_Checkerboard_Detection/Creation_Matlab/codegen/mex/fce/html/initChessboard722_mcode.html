<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="127,1" id="srcline1"> 1</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="127,2" id="srcline2"> 2</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T139U3">chessboard</span> = initChessboard(<span class="var type1" id="S3T4U6">corners</span>,<span class="var type1" id="S4T8U7">idx</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="127,3" id="srcline3"> 3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="127,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% return if not enough corners</span></span></span>
<span class="srcline"><span class="lineno"><a href="127,5" id="srcline5"> 5</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T10:U4"><span class="mxinfo " id="T8:U5">size(<span class="mxinfo " id="T5:U6"><span class="var type1" id="S3T4U14">corners</span>.p</span>,1)</span>&lt;<span class="mxinfo " id="T8:U8">9</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="127,6" id="srcline6"> 6</a></span><span class="line">      <span class="mxinfo " id="T139:U9"><span class="var type1" id="S2T139U20">chessboard</span> = <span class="mxinfo " id="T71:U11">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,7" id="srcline7"> 7</a></span><span class="line">      <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,8" id="srcline8"> 8</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="127,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="127,10" id="srcline10">10</a></span><span class="line">    <span class="comment">% init chessboard hypothesis</span></span></span>
<span class="srcline"><span class="lineno"><a href="127,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T139:U12"><span class="var type1" id="S2T139U26">chessboard</span> = <span class="mxinfo " id="T28:U14">zeros(<span class="mxinfo " id="T8:U15">3</span>,<span class="mxinfo " id="T8:U16">3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,12" id="srcline12">12</a></span><span class="line">    coder.varsize(<span class="string">'chessboard'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="127,13" id="srcline13">13</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="127,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T51:U17"><span class="var type1" id="S8T51U39">dist1</span>=<span class="mxinfo " id="T51:U19">zeros(<span class="mxinfo " id="T8:U20">1</span>,<span class="mxinfo " id="T8:U21">2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T137:U22"><span class="var type1" id="S9T137U46">dist2</span>=<span class="mxinfo " id="T137:U24">zeros(<span class="mxinfo " id="T8:U25">1</span>,<span class="mxinfo " id="T8:U26">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="127,17" id="srcline17">17</a></span><span class="line">    <span class="comment">% extract feature index and orientation (central element)</span></span></span>
<span class="srcline"><span class="lineno"><a href="127,18" id="srcline18">18</a></span><span class="line">    <span class="mxinfo " id="T109:U27"><span class="var type1" id="S10T109U53">v1</span> = <span class="mxinfo " id="T109:U29"><span class="mxinfo " id="T6:U30"><span class="var type1" id="S3T4U56">corners</span>.v1</span>(<span class="var type1" id="S4T8U58">idx</span>,<span class="mxinfo " id="T110:U33">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T109:U34"><span class="var type1" id="S11T109U62">v2</span> = <span class="mxinfo " id="T109:U36"><span class="mxinfo " id="T6:U37"><span class="var type1" id="S3T4U65">corners</span>.v2</span>(<span class="var type1" id="S4T8U67">idx</span>,<span class="mxinfo " id="T110:U40">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T8:U41"><span class="mxinfo " id="T8:U42"><span class="var type1" id="S2T139U72">chessboard</span>(<span class="mxinfo " id="T8:U44">2</span>,<span class="mxinfo " id="T8:U45">2</span>)</span> = <span class="var type1" id="S4T8U75">idx</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="127,22" id="srcline22">22</a></span><span class="line">    <span class="comment">% find left/right/top/bottom neighbors</span></span></span>
<span class="srcline"><span class="lineno"><a href="127,23" id="srcline23">23</a></span><span class="line">    [<span class="mxinfo " id="T8:U47"><span class="var type1" id="S2T139U80">chessboard</span>(<span class="mxinfo " id="T8:U49">2</span>,<span class="mxinfo " id="T8:U50">3</span>)</span>,<span class="mxinfo " id="T8:U51"><span class="var type1" id="S8T51U84">dist1</span>(<span class="mxinfo " id="T29:U53">1</span>)</span>] = <span class="fcn" id="F655N15:B87">directionalNeighbor</span>(<span class="var type1" id="S4T8U88">idx</span>,+<span class="var type1" id="S10T109U90">v1</span>,<span class="var type1" id="S2T139U91">chessboard</span>,<span class="var type1" id="S3T4U92">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="127,24" id="srcline24">24</a></span><span class="line">    [<span class="mxinfo " id="T8:U58"><span class="var type1" id="S2T139U97">chessboard</span>(<span class="mxinfo " id="T8:U60">2</span>,<span class="mxinfo " id="T8:U61">1</span>)</span>,<span class="mxinfo " id="T8:U62"><span class="var type1" id="S8T51U101">dist1</span>(<span class="mxinfo " id="T29:U64">2</span>)</span>] = <span class="fcn" id="F655N15:B104">directionalNeighbor</span>(<span class="var type1" id="S4T8U105">idx</span>,<span class="mxinfo " id="T109:U66">-<span class="var type1" id="S10T109U107">v1</span></span>,<span class="var type1" id="S2T139U108">chessboard</span>,<span class="var type1" id="S3T4U109">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="127,25" id="srcline25">25</a></span><span class="line">    [<span class="mxinfo " id="T8:U70"><span class="var type1" id="S2T139U114">chessboard</span>(<span class="mxinfo " id="T8:U72">3</span>,<span class="mxinfo " id="T8:U73">2</span>)</span>,<span class="mxinfo " id="T8:U74"><span class="var type1" id="S9T137U118">dist2</span>(<span class="mxinfo " id="T29:U76">1</span>)</span>] = <span class="fcn" id="F655N15:B121">directionalNeighbor</span>(<span class="var type1" id="S4T8U122">idx</span>,+<span class="var type1" id="S11T109U124">v2</span>,<span class="var type1" id="S2T139U125">chessboard</span>,<span class="var type1" id="S3T4U126">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="127,26" id="srcline26">26</a></span><span class="line">    [<span class="mxinfo " id="T8:U81"><span class="var type1" id="S2T139U131">chessboard</span>(<span class="mxinfo " id="T8:U83">1</span>,<span class="mxinfo " id="T8:U84">2</span>)</span>,<span class="mxinfo " id="T8:U85"><span class="var type1" id="S9T137U135">dist2</span>(<span class="mxinfo " id="T29:U87">2</span>)</span>] = <span class="fcn" id="F655N15:B138">directionalNeighbor</span>(<span class="var type1" id="S4T8U139">idx</span>,<span class="mxinfo " id="T109:U89">-<span class="var type1" id="S11T109U141">v2</span></span>,<span class="var type1" id="S2T139U142">chessboard</span>,<span class="var type1" id="S3T4U143">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="127,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="127,28" id="srcline28">28</a></span><span class="line">    <span class="comment">% find top-left/top-right/bottom-left/bottom-right neighbors</span></span></span>
<span class="srcline"><span class="lineno"><a href="127,29" id="srcline29">29</a></span><span class="line">    [<span class="mxinfo " id="T8:U93"><span class="var type1" id="S2T139U148">chessboard</span>(<span class="mxinfo " id="T8:U95">1</span>,<span class="mxinfo " id="T8:U96">1</span>)</span>,<span class="mxinfo " id="T8:U97"><span class="var type1" id="S9T137U152">dist2</span>(<span class="mxinfo " id="T29:U99">3</span>)</span>] = <span class="fcn" id="F655N15:B155">directionalNeighbor</span>(<span class="mxinfo " id="T8:U100"><span class="var type1" id="S2T139U157">chessboard</span>(<span class="mxinfo " id="T8:U102">2</span>,<span class="mxinfo " id="T8:U103">1</span>)</span>,<span class="mxinfo " id="T109:U104">-<span class="var type1" id="S11T109U161">v2</span></span>,<span class="var type1" id="S2T139U162">chessboard</span>,<span class="var type1" id="S3T4U163">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="127,30" id="srcline30">30</a></span><span class="line">    [<span class="mxinfo " id="T8:U108"><span class="var type1" id="S2T139U168">chessboard</span>(<span class="mxinfo " id="T8:U110">3</span>,<span class="mxinfo " id="T8:U111">1</span>)</span>,<span class="mxinfo " id="T8:U112"><span class="var type1" id="S9T137U172">dist2</span>(<span class="mxinfo " id="T29:U114">4</span>)</span>] = <span class="fcn" id="F655N15:B175">directionalNeighbor</span>(<span class="mxinfo " id="T8:U115"><span class="var type1" id="S2T139U177">chessboard</span>(<span class="mxinfo " id="T8:U117">2</span>,<span class="mxinfo " id="T8:U118">1</span>)</span>,+<span class="var type1" id="S11T109U181">v2</span>,<span class="var type1" id="S2T139U182">chessboard</span>,<span class="var type1" id="S3T4U183">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="127,31" id="srcline31">31</a></span><span class="line">    [<span class="mxinfo " id="T8:U122"><span class="var type1" id="S2T139U188">chessboard</span>(<span class="mxinfo " id="T8:U124">1</span>,<span class="mxinfo " id="T8:U125">3</span>)</span>,<span class="mxinfo " id="T8:U126"><span class="var type1" id="S9T137U192">dist2</span>(<span class="mxinfo " id="T29:U128">5</span>)</span>] = <span class="fcn" id="F655N15:B195">directionalNeighbor</span>(<span class="mxinfo " id="T8:U129"><span class="var type1" id="S2T139U197">chessboard</span>(<span class="mxinfo " id="T8:U131">2</span>,<span class="mxinfo " id="T8:U132">3</span>)</span>,<span class="mxinfo " id="T109:U133">-<span class="var type1" id="S11T109U201">v2</span></span>,<span class="var type1" id="S2T139U202">chessboard</span>,<span class="var type1" id="S3T4U203">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="127,32" id="srcline32">32</a></span><span class="line">    [<span class="mxinfo " id="T8:U137"><span class="var type1" id="S2T139U208">chessboard</span>(<span class="mxinfo " id="T8:U139">3</span>,<span class="mxinfo " id="T8:U140">3</span>)</span>,<span class="mxinfo " id="T8:U141"><span class="var type1" id="S9T137U212">dist2</span>(<span class="mxinfo " id="T29:U143">6</span>)</span>] = <span class="fcn" id="F655N15:B215">directionalNeighbor</span>(<span class="mxinfo " id="T8:U144"><span class="var type1" id="S2T139U217">chessboard</span>(<span class="mxinfo " id="T8:U146">2</span>,<span class="mxinfo " id="T8:U147">3</span>)</span>,+<span class="var type1" id="S11T109U221">v2</span>,<span class="var type1" id="S2T139U222">chessboard</span>,<span class="var type1" id="S3T4U223">corners</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="127,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="127,34" id="srcline34">34</a></span><span class="line">    <span class="comment">% initialization must be homogenously distributed</span></span></span>
<span class="srcline"><span class="lineno"><a href="127,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo " id="T10:U151"><span class="keyword">if</span> <span class="mxinfo " id="T10:U152"><span class="mxinfo " id="T10:U153">any(<span class="mxinfo " id="T136:U154">isinf(<span class="var type1" id="S8T51U233">dist1</span>)</span>)</span> || <span class="mxinfo " id="T10:U156">any(<span class="mxinfo " id="T138:U157">isinf(<span class="var type1" id="S9T137U238">dist2</span>)</span>)</span> || <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="127,36" id="srcline36">36</a></span><span class="line">       <span class="mxinfo " id="T10:U159"><span class="mxinfo " id="T8:U160"><span class="mxinfo " id="T8:U161">std(<span class="var type1" id="S8T51U243">dist1</span>)</span>/<span class="mxinfo " id="T8:U163">mean(<span class="var type1" id="S8T51U246">dist1</span>)</span></span>&gt;<span class="mxinfo " id="T8:U165">0.3</span></span> || <span class="mxinfo " id="T10:U166"><span class="mxinfo " id="T8:U167"><span class="mxinfo " id="T8:U168">std(<span class="var type1" id="S9T137U252">dist2</span>)</span>/<span class="mxinfo " id="T8:U170">mean(<span class="var type1" id="S9T137U255">dist2</span>)</span></span>&gt;<span class="mxinfo " id="T8:U172">0.3</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="127,37" id="srcline37">37</a></span><span class="line">      <span class="mxinfo " id="T139:U173"><span class="var type1" id="S2T139U259">chessboard</span> = <span class="mxinfo " id="T71:U175">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,38" id="srcline38">38</a></span><span class="line">      <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="127,39" id="srcline39">39</a></span><span class="line">    <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="127,40" id="srcline40">40</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="127,41" id="srcline41">41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="127,42" id="srcline42">42</a></span><span class="line"></span></span>
</pre>
