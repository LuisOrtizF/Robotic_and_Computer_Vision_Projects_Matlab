<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="129,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="129,54" id="srcline54"> 54</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S19T6U286">pred</span> = predictCorners(<span class="var type1" id="S20T5U289">p1</span>,<span class="var type1" id="S21T5U290">p2</span>,<span class="var type1" id="S22T5U291">p3</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="129,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="129,56" id="srcline56"> 56</a></span><span class="line">    <span class="comment">% compute vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="129,57" id="srcline57"> 57</a></span><span class="line">    <span class="mxinfo " id="T5:U5"><span class="var type1" id="S23T5U294">v1</span> = <span class="mxinfo " id="T5:U7"><span class="var type1" id="S21T5U296">p2</span>-<span class="var type1" id="S20T5U297">p1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="129,58" id="srcline58"> 58</a></span><span class="line">    <span class="mxinfo " id="T5:U10"><span class="var type1" id="S24T5U300">v2</span> = <span class="mxinfo " id="T5:U12"><span class="var type1" id="S22T5U302">p3</span>-<span class="var type1" id="S21T5U303">p2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="129,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="129,60" id="srcline60"> 60</a></span><span class="line">    <span class="comment">% predict angles</span></span></span>
<span class="srcline"><span class="lineno"><a href="129,61" id="srcline61"> 61</a></span><span class="line">    <span class="mxinfo " id="T7:U15"><span class="var type1" id="S25T7U306">a1</span> = <span class="mxinfo " id="T7:U17">atan2(<span class="mxinfo " id="T7:U18"><span class="var type1" id="S23T5U310">v1</span>(<span class="mxinfo " id="T93:U20">:</span>,<span class="mxinfo " id="T8:U21">2</span>)</span>,<span class="mxinfo " id="T7:U22"><span class="var type1" id="S23T5U314">v1</span>(<span class="mxinfo " id="T93:U24">:</span>,<span class="mxinfo " id="T8:U25">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="129,62" id="srcline62"> 62</a></span><span class="line">    <span class="mxinfo " id="T7:U26"><span class="var type1" id="S27T7U319">a2</span> = <span class="mxinfo " id="T7:U28">atan2(<span class="mxinfo " id="T7:U29"><span class="var type1" id="S24T5U323">v2</span>(<span class="mxinfo " id="T93:U31">:</span>,<span class="mxinfo " id="T8:U32">2</span>)</span>,<span class="mxinfo " id="T7:U33"><span class="var type1" id="S24T5U327">v2</span>(<span class="mxinfo " id="T93:U35">:</span>,<span class="mxinfo " id="T8:U36">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="129,63" id="srcline63"> 63</a></span><span class="line">    <span class="mxinfo " id="T7:U37"><span class="var type1" id="S28T7U332">a3</span> = <span class="mxinfo " id="T7:U39"><span class="mxinfo " id="T7:U40"><span class="mxinfo " id="T8:U41">2</span>*<span class="var type1" id="S27T7U336">a2</span></span>-<span class="var type1" id="S25T7U337">a1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="129,64" id="srcline64"> 64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="129,65" id="srcline65"> 65</a></span><span class="line">    <span class="comment">% predict scales</span></span></span>
<span class="srcline"><span class="lineno"><a href="129,66" id="srcline66"> 66</a></span><span class="line">    <span class="mxinfo " id="T7:U44"><span class="var type1" id="S29T7U340">s1</span> = <span class="mxinfo " id="T7:U46">sqrt(<span class="mxinfo " id="T7:U47"><span class="mxinfo " id="T7:U48"><span class="mxinfo " id="T7:U49"><span class="var type1" id="S23T5U346">v1</span>(<span class="mxinfo " id="T93:U51">:</span>,<span class="mxinfo " id="T8:U52">1</span>)</span>.^2</span>+<span class="mxinfo " id="T7:U53"><span class="mxinfo " id="T7:U54"><span class="var type1" id="S23T5U352">v1</span>(<span class="mxinfo " id="T93:U56">:</span>,<span class="mxinfo " id="T8:U57">2</span>)</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="129,67" id="srcline67"> 67</a></span><span class="line">    <span class="mxinfo " id="T7:U58"><span class="var type1" id="S31T7U358">s2</span> = <span class="mxinfo " id="T7:U60">sqrt(<span class="mxinfo " id="T7:U61"><span class="mxinfo " id="T7:U62"><span class="mxinfo " id="T7:U63"><span class="var type1" id="S24T5U364">v2</span>(<span class="mxinfo " id="T93:U65">:</span>,<span class="mxinfo " id="T8:U66">1</span>)</span>.^2</span>+<span class="mxinfo " id="T7:U67"><span class="mxinfo " id="T7:U68"><span class="var type1" id="S24T5U370">v2</span>(<span class="mxinfo " id="T93:U70">:</span>,<span class="mxinfo " id="T8:U71">2</span>)</span>.^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="129,68" id="srcline68"> 68</a></span><span class="line">    <span class="mxinfo " id="T7:U72"><span class="var type1" id="S32T7U376">s3</span> = <span class="mxinfo " id="T7:U74"><span class="mxinfo " id="T7:U75"><span class="mxinfo " id="T8:U76">2</span>*<span class="var type1" id="S31T7U380">s2</span></span>-<span class="var type1" id="S29T7U381">s1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="129,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="129,70" id="srcline70"> 70</a></span><span class="line">    <span class="comment">% predict p3 (the factor 0.75 ensures that under extreme</span></span></span>
<span class="srcline"><span class="lineno"><a href="129,71" id="srcline71"> 71</a></span><span class="line">    <span class="comment">% distortions (omnicam) the closer prediction is selected)</span></span></span>
<span class="srcline"><span class="lineno"><a href="129,72" id="srcline72"> 72</a></span><span class="line">    <span class="mxinfo " id="T6:U79"><span class="var type1" id="S19T6U384">pred</span> = <span class="mxinfo " id="T6:U81"><span class="var type1" id="S22T5U386">p3</span> + <span class="mxinfo " id="T6:U83"><span class="mxinfo " id="T6:U84"><span class="mxinfo " id="T7:U85"><span class="mxinfo " id="T8:U86">0.75</span>*<span class="var type1" id="S32T7U391">s3</span></span>*<span class="mxinfo " id="T51:U88">ones(<span class="mxinfo " id="T8:U89">1</span>,<span class="mxinfo " id="T8:U90">2</span>)</span></span> .* <span class="mxinfo " id="T6:U91">[<span class="mxinfo " id="T7:U92">cos(<span class="var type1" id="S28T7U400">a3</span>)</span> <span class="mxinfo " id="T7:U94">sin(<span class="var type1" id="S28T7U403">a3</span>)</span>]</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="129,73" id="srcline73"> 73</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="129,74" id="srcline74"> 74</a></span><span class="line"></span></span>
</pre>
