<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="122,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T4U3">corners</span> = scoreCorners(<span class="var type1" id="S3T26U6">img</span>,<span class="mxinfo " id="T26:U3">~</span>,<span class="var type1" id="S4T26U8">img_weight</span>,<span class="var type1" id="S2T4U9">corners</span>,<span class="var type1" id="S5T118U10">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="122,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,3" id="srcline3"> 3</a></span><span class="line">    <span class="mxinfo " id="T8:U7"><span class="var type1" id="S6T8U13">width</span>  = <span class="mxinfo " id="T8:U9">size(<span class="var type1" id="S3T26U16">img</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,4" id="srcline4"> 4</a></span><span class="line">    <span class="mxinfo " id="T8:U11"><span class="var type1" id="S8T8U20">height</span> = <span class="mxinfo " id="T8:U13">size(<span class="var type1" id="S3T26U23">img</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,6" id="srcline6"> 6</a></span><span class="line">    <span class="mxinfo " id="T118:U15"><span class="var type1" id="S9T118U27">score</span>=<span class="mxinfo " id="T118:U17">zeros(<span class="mxinfo " id="T8:U18">1</span>,<span class="mxinfo " id="T8:U19">length(<span class="var type1" id="S5T118U33">radius</span>)</span>)</span></span>;  </span></span>
<span class="srcline"><span class="lineno"><a href="122,7" id="srcline7"> 7</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="122,8" id="srcline8"> 8</a></span><span class="line">    <span class="comment">% for all corners do</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,9" id="srcline9"> 9</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S12T8U36">i</span>=<span class="mxinfo " id="T8:U22">1</span>:size(<span class="mxinfo " id="T5:U23"><span class="var type1" id="S2T4U42">corners</span>.p</span>,1)</span></span>
<span class="srcline"><span class="lineno"><a href="122,10" id="srcline10">10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,11" id="srcline11">11</a></span><span class="line">      <span class="comment">% corner location</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,12" id="srcline12">12</a></span><span class="line">      <span class="mxinfo " id="T8:U25"><span class="var type1" id="S13T8U47">u</span> = <span class="mxinfo " id="T8:U27">round(<span class="mxinfo " id="T8:U28"><span class="mxinfo " id="T5:U29"><span class="var type1" id="S2T4U52">corners</span>.p</span>(<span class="var type1" id="S12T8U54">i</span>,<span class="mxinfo " id="T8:U32">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,13" id="srcline13">13</a></span><span class="line">      <span class="mxinfo " id="T8:U33"><span class="var type1" id="S15T8U58">v</span> = <span class="mxinfo " id="T8:U35">round(<span class="mxinfo " id="T8:U36"><span class="mxinfo " id="T5:U37"><span class="var type1" id="S2T4U63">corners</span>.p</span>(<span class="var type1" id="S12T8U65">i</span>,<span class="mxinfo " id="T8:U40">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,15" id="srcline15">15</a></span><span class="line">      <span class="comment">% compute corner statistics @ radius 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,16" id="srcline16">16</a></span><span class="line">      <span class="keyword">for</span> <span class="var type1" id="S16T8U69">j</span>=<span class="mxinfo " id="T8:U42">1</span>:length(<span class="var type1" id="S5T118U74">radius</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="122,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo " id="T8:U44"><span class="mxinfo " id="T8:U45"><span class="var type1" id="S9T118U78">score</span>(<span class="var type1" id="S16T8U79">j</span>)</span> = <span class="mxinfo " id="T8:U48">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,18" id="srcline18">18</a></span><span class="line">        <span class="mxinfo " id="T10:U49"><span class="keyword">if</span> <span class="mxinfo " id="T10:U50"><span class="mxinfo " id="T10:U51"><span class="var type1" id="S13T8U87">u</span>&gt;<span class="mxinfo " id="T8:U53"><span class="var type1" id="S5T118U89">radius</span>(<span class="var type1" id="S16T8U90">j</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T10:U56"><span class="var type1" id="S13T8U92">u</span>&lt;=<span class="mxinfo " id="T8:U58"><span class="var type1" id="S6T8U94">width</span>-<span class="mxinfo " id="T8:U60"><span class="var type1" id="S5T118U96">radius</span>(<span class="var type1" id="S16T8U97">j</span>)</span></span></span> &amp;&amp; <span class="mxinfo " id="T10:U63"><span class="var type1" id="S15T8U99">v</span>&gt;<span class="mxinfo " id="T8:U65"><span class="var type1" id="S5T118U101">radius</span>(<span class="var type1" id="S16T8U102">j</span>)</span></span> &amp;&amp; <span class="mxinfo " id="T10:U68"><span class="var type1" id="S15T8U104">v</span>&lt;=<span class="mxinfo " id="T8:U70"><span class="var type1" id="S8T8U106">height</span>-<span class="mxinfo " id="T8:U72"><span class="var type1" id="S5T118U108">radius</span>(<span class="var type1" id="S16T8U109">j</span>)</span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="122,19" id="srcline19">19</a></span><span class="line">          <span class="mxinfo " id="T112:U75"><span class="var type1" id="S17T112U112">img_sub</span>        = <span class="mxinfo " id="T112:U77"><span class="var type1" id="S3T26U114">img</span>(<span class="mxinfo " id="T108:U79"><span class="mxinfo " id="T8:U80"><span class="var type1" id="S15T8U117">v</span>-<span class="mxinfo " id="T8:U82"><span class="var type1" id="S5T118U119">radius</span>(<span class="var type1" id="S16T8U120">j</span>)</span></span>:<span class="mxinfo " id="T8:U85"><span class="var type1" id="S15T8U122">v</span>+<span class="mxinfo " id="T8:U87"><span class="var type1" id="S5T118U124">radius</span>(<span class="var type1" id="S16T8U125">j</span>)</span></span></span>,<span class="mxinfo " id="T119:U90"><span class="mxinfo " id="T8:U91"><span class="var type1" id="S13T8U128">u</span>-<span class="mxinfo " id="T8:U93"><span class="var type1" id="S5T118U130">radius</span>(<span class="var type1" id="S16T8U131">j</span>)</span></span>:<span class="mxinfo " id="T8:U96"><span class="var type1" id="S13T8U133">u</span>+<span class="mxinfo " id="T8:U98"><span class="var type1" id="S5T118U135">radius</span>(<span class="var type1" id="S16T8U136">j</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,20" id="srcline20">20</a></span><span class="line">          <span class="mxinfo " id="T112:U101"><span class="var type1" id="S18T112U139">img_weight_sub</span> = <span class="mxinfo " id="T112:U103"><span class="var type1" id="S4T26U141">img_weight</span>(<span class="mxinfo " id="T108:U105"><span class="mxinfo " id="T8:U106"><span class="var type1" id="S15T8U144">v</span>-<span class="mxinfo " id="T8:U108"><span class="var type1" id="S5T118U146">radius</span>(<span class="var type1" id="S16T8U147">j</span>)</span></span>:<span class="mxinfo " id="T8:U111"><span class="var type1" id="S15T8U149">v</span>+<span class="mxinfo " id="T8:U113"><span class="var type1" id="S5T118U151">radius</span>(<span class="var type1" id="S16T8U152">j</span>)</span></span></span>,<span class="mxinfo " id="T119:U116"><span class="mxinfo " id="T8:U117"><span class="var type1" id="S13T8U155">u</span>-<span class="mxinfo " id="T8:U119"><span class="var type1" id="S5T118U157">radius</span>(<span class="var type1" id="S16T8U158">j</span>)</span></span>:<span class="mxinfo " id="T8:U122"><span class="var type1" id="S13T8U160">u</span>+<span class="mxinfo " id="T8:U124"><span class="var type1" id="S5T118U162">radius</span>(<span class="var type1" id="S16T8U163">j</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,21" id="srcline21">21</a></span><span class="line">          <span class="mxinfo " id="T8:U127"><span class="mxinfo " id="T8:U128"><span class="var type1" id="S9T118U167">score</span>(<span class="var type1" id="S16T8U168">j</span>)</span>       = <span class="mxinfo " id="T8:U131"><span class="fcn" id="F559N5:B170">cornerCorrelationScore</span>(<span class="var type1" id="S17T112U171">img_sub</span>,<span class="var type1" id="S18T112U172">img_weight_sub</span>,<span class="mxinfo " id="T109:U134"><span class="mxinfo " id="T6:U135"><span class="var type1" id="S2T4U175">corners</span>.v1</span>(<span class="var type1" id="S12T8U177">i</span>,<span class="mxinfo " id="T110:U138">:</span>)</span>,<span class="mxinfo " id="T109:U139"><span class="mxinfo " id="T6:U140"><span class="var type1" id="S2T4U181">corners</span>.v2</span>(<span class="var type1" id="S12T8U183">i</span>,<span class="mxinfo " id="T110:U143">:</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,22" id="srcline22">22</a></span><span class="line">        <span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="122,23" id="srcline23">23</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,25" id="srcline25">25</a></span><span class="line">      <span class="comment">% take highest score</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,26" id="srcline26">26</a></span><span class="line">      <span class="mxinfo " id="T8:U144"><span class="mxinfo " id="T8:U145"><span class="mxinfo " id="T7:U146"><span class="var type1" id="S2T4U189">corners</span>.score</span>(<span class="var type1" id="S12T8U191">i</span>,<span class="mxinfo " id="T8:U149">1</span>)</span> = <span class="mxinfo " id="T8:U150">max(<span class="var type1" id="S9T118U195">score</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,27" id="srcline27">27</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,28" id="srcline28">28</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
